============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\goyos\OneDrive\ドキュメント\VSCode_Dev\PythonDev\journal-ai-auditor\backend\venv\Scripts\python.exe
codspeed: 4.3.0 (disabled, mode: walltime, callgraph: not supported, timer_resolution: 100.0ns)
cachedir: .pytest_cache
benchmark: 5.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: C:\Users\goyos\OneDrive\ドキュメント\VSCode_Dev\PythonDev\journal-ai-auditor\backend
configfile: pyproject.toml
plugins: anyio-4.12.1, langsmith-0.6.7, asyncio-1.3.0, benchmark-5.2.3, codspeed-4.3.0, cov-7.0.0, recording-0.13.4, socket-0.7.0, syrupy-4.9.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/test_dashboard_filters.py::test_get_filter_options PASSED          [ 20%]
tests/test_dashboard_filters.py::test_dashboard_summary_with_filters PASSED [ 40%]
tests/test_dashboard_filters.py::test_dashboard_summary_with_multiple_filters PASSED [ 60%]
tests/test_dashboard_filters.py::test_time_series_with_filters PASSED    [ 80%]
tests/test_dashboard_filters.py::test_risk_analysis_with_filters PASSED  [100%]
ERROR: Coverage failure: total of 34 is less than fail-under=50


============================== warnings summary ===============================
tests/test_dashboard_filters.py::test_get_filter_options
  C:\Users\goyos\OneDrive\ドキュメント\VSCode_Dev\PythonDev\journal-ai-auditor\backend\app\api\endpoints\dashboard.py:402: FastAPIDeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    aggregation: str = Query("daily", regex="^(daily|weekly|monthly)$"),

tests/test_dashboard_filters.py::test_get_filter_options
  C:\Users\goyos\OneDrive\ドキュメント\VSCode_Dev\PythonDev\journal-ai-auditor\backend\app\api\endpoints\dashboard.py:707: FastAPIDeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    comparison_type: str = Query(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.5-final-0 _______________

Name                                   Stmts   Miss  Cover   Missing
--------------------------------------------------------------------
app\agents\__init__.py                     8      0   100%
app\agents\analysis.py                   102     84    18%   59-60, 64, 68, 77-99, 110-139, 156-236, 256-266, 280-290, 306-325
app\agents\base.py                       180     95    47%   112, 141-231, 254-257, 274-277, 285, 293, 307-309, 325, 356-374, 386-426, 442-454, 470-513, 529-531
app\agents\documentation.py               64     45    30%   60-61, 65, 69, 73-94, 98, 102-129, 137, 156-174, 188-200, 216-244
app\agents\investigation.py               65     46    29%   73-74, 78, 82, 90-109, 113-140, 148, 165-176, 192-210, 226-244, 258-269
app\agents\orchestrator.py               223    180    19%   59, 85-92, 112-149, 169-261, 267-293, 299-340, 346-357, 372-385, 407-411, 458-486, 502-523, 541-571, 589-625, 629-658, 663-679, 687
app\agents\qa.py                          58     40    31%   53-54, 58, 62, 66-85, 89-116, 124, 143-144, 158-168, 182-189
app\agents\review.py                      64     45    30%   54-55, 59, 63, 67-86, 90-117, 125, 142-152, 166-178, 192-203, 217-235
app\agents\tools.py                      189    156    17%   22-24, 49-95, 114-144, 165-209, 226-255, 272-300, 317-342, 359-403, 416-441, 454-483, 502-529, 562-591, 610-644
app\api\__init__.py                       15      0   100%
app\api\endpoints\__init__.py              2      0   100%
app\api\endpoints\agents.py              204    135    34%   43-45, 124-158, 178-216, 225-229, 249-274, 290-320, 335-360, 375-397, 412-463, 472-473, 483-498, 507, 513-514
app\api\endpoints\analysis.py            226    149    34%   23, 142-232, 262-332, 361-452, 474-645, 666-714, 737-753
app\api\endpoints\audit.py                20      8    60%   22, 38-39, 58-62
app\api\endpoints\batch.py                85     42    51%   30-32, 96-136, 153-162, 187-188, 198-201, 221-245
app\api\endpoints\dashboard.py           341    141    59%   60-61, 85-87, 192-288, 294-302, 323, 383, 429-432, 472-520, 593-596, 636-678, 713-800, 813-862
app\api\endpoints\health.py               24     16    33%   19, 33-52
app\api\endpoints\import_data.py         136     72    47%   96-130, 153-164, 181-201, 214-246, 259-285, 298-301, 328-335
app\api\endpoints\journals.py             90     79    12%   21, 56-153, 177-282
app\api\endpoints\llm_usage.py            12      4    67%   20, 28-30
app\api\endpoints\reports.py             255    180    29%   25, 30, 112-145, 166-227, 240-310, 320-371, 401-490, 510-531, 571-626, 642-710, 729-788, 806, 844, 899-944, 976-1003, 1029-1056
app\api\endpoints\rules.py               126     99    21%   26, 31-52, 73-94, 111-160, 173-197, 222-288, 301-336
app\api\endpoints\settings.py             47     32    32%   24, 40-59, 72-99
app\core\__init__.py                       4      0   100%
app\core\cache.py                         53     14    74%   53-60, 66, 73, 77-78, 82-83, 88
app\core\config.py                        66      4    94%   293, 297, 307, 309
app\core\exceptions.py                   292    165    43%   79-85, 94, 102-104, 136-143, 164-173, 192-197, 228-232, 251-256, 275-280, 311-316, 335-341, 384-390, 409-413, 432-437, 468-473, 494-500, 519-523, 555-559, 578-582, 607-612, 631-634, 655-662, 683-690, 716-719, 761-766, 786-791, 816-820, 834-836, 856-860
app\core\logging.py                      164     49    70%   176, 240, 287, 432-436, 440-444, 448-464, 490-541
app\core\middleware.py                   206     53    74%   152, 171-176, 196, 201-210, 245, 250, 279, 284-289, 295-302, 314-316, 326-329, 347-356, 373, 377, 428-442, 459, 463, 516-526, 573-584, 609-623, 730-734, 748
app\db\__init__.py                         3      0   100%
app\db\duckdb.py                          76     21    72%   35-36, 99-101, 113-117, 128-133, 144-145, 149-153, 184
app\db\schema.py                           3      0   100%
app\db\sqlite.py                          65     23    65%   32-33, 73-75, 91-94, 110-117, 137-144
app\main.py                               59      6    90%   73, 92-94, 201, 210
app\models\__init__.py                     4      4     0%   3-22
app\models\analysis.py                    75     75     0%   3-142
app\models\journal.py                     83     83     0%   3-239
app\models\master.py                      64     64     0%   3-254
app\services\__init__.py                   6      0   100%
app\services\aggregation.py              110     80    27%   51, 62-93, 109-128, 138-158, 162-182, 186-207, 211-228, 232-249, 253-280, 284-301, 305-342, 346-379, 385-415, 419-450, 454-473, 477-500, 504-526, 530-549, 553-583, 587-607
app\services\audit_service.py             55     42    24%   23, 54-79, 102-163, 167-189
app\services\batch.py                    169     98    42%   90, 94, 129-135, 139-144, 158-236, 247, 262-288, 301, 309-326, 345-346, 360-366, 382-390, 404-410, 421, 432-437
app\services\import_service.py           199    172    14%   21-32, 36, 141-152, 164-165, 184-207, 225-239, 280-289, 315-409, 426-430, 449-494, 506-521, 541-618
app\services\llm\__init__.py               3      0   100%
app\services\llm\cost_tracker.py          31     24    23%   84-99, 127-129, 154-232, 253-269
app\services\llm\models.py                41      3    93%   46, 50, 54
app\services\llm\service.py              142    120    15%   31-35, 39-104, 122-163, 169-179, 194-206, 221-235, 250-291, 303-315, 330-346, 361-376, 392-412, 426-438, 443, 449
app\services\report_generator.py         951    951     0%   8-2229
app\services\rules\__init__.py            10      0   100%
app\services\rules\account_rules.py      556    313    44%   42, 46, 50, 54, 58, 61-106, 114, 118, 122, 126, 130, 133-164, 172, 176, 180, 184, 188, 191-233, 241, 245, 249, 253, 257, 260-301, 309, 313, 317, 321, 325, 328-368, 376, 380, 384, 388, 392, 395-399, 407, 411, 415, 419, 423, 426-452, 460, 464, 468, 472, 476, 479-511, 519, 523, 527, 531, 535, 538-564, 572, 576, 580, 584, 588, 591-620, 628, 632, 636, 640, 644, 647-650, 658, 662, 666, 670, 674, 677-704, 712, 716, 720, 724, 728, 731-733, 741, 745, 749, 753, 757, 760-780, 788, 792, 796, 800, 804, 807-829, 837, 841, 845, 849, 853, 856-880, 888, 892, 896, 900, 904, 907-931, 939, 943, 947, 951, 955, 958-982, 990, 994, 998, 1002, 1006, 1009-1030, 1038, 1042, 1046, 1050, 1054, 1057-1091, 1100-1131
app\services\rules\amount_rules.py       455    271    40%   37, 41, 45, 49, 53, 56-79, 87, 91, 95, 99, 103, 106-131, 139, 143, 147, 151, 155, 158-190, 198, 202, 206, 210, 214, 218-235, 238-260, 268, 272, 276, 280, 284, 287-329, 337, 341, 345, 349, 353, 356-404, 412, 416, 420, 424, 428, 431-462, 470, 474, 478, 482, 486, 489-513, 521, 525, 529, 533, 537, 540-583, 591, 595, 599, 603, 607, 610-659, 667, 671, 675, 679, 683, 686-748, 756, 760, 764, 768, 772, 775-812, 820, 824, 828, 832, 836, 839-909, 917, 921, 925, 929, 933, 936-982, 990, 994, 998, 1002, 1006, 1009-1035, 1044-1070
app\services\rules\approval_rules.py     212    125    41%   30, 34, 38, 42, 46, 49-80, 88, 92, 96, 100, 104, 107-132, 140, 144, 148, 152, 156, 159-199, 207, 211, 215, 219, 223, 226-269, 277, 281, 285, 289, 293, 296-341, 349, 353, 357, 361, 365, 368-409, 473, 477, 481, 485, 489, 492-519, 528-547
app\services\rules\base.py               112     26    77%   56, 87, 92-94, 98, 137-139, 174, 186, 202, 229-238, 251, 264-266, 274, 285, 289, 300, 305, 308, 311
app\services\rules\benford.py            290    196    32%   76-83, 95-101, 113-119, 141, 145, 188-233, 249-288, 295-296, 300, 304, 308, 312, 316, 319-353, 360-361, 365, 369, 373, 377, 381, 384-411, 418-419, 423, 427, 431, 435, 439, 442-479, 487, 491, 495, 499, 503, 506-557, 564-565, 569, 573, 577, 581, 587, 590-649, 658-674
app\services\rules\ml_detection.py       294    210    29%   57-58, 70-151, 162-163, 174-176, 188-192, 196, 200, 204, 208, 212, 215-269, 281-284, 288, 292, 296, 300, 306, 309-353, 365-368, 372, 376, 380, 384, 388, 391-439, 454-456, 460, 464, 468, 472, 476, 479-531, 542-544, 548, 552, 556, 560, 564, 567-649, 658-674
app\services\rules\rule_engine.py        156    116    26%   43, 81-84, 92, 100-102, 113, 124, 128, 133, 153-178, 194-208, 226-269, 285-295, 316-328, 342-397, 408-444, 458-481
app\services\rules\scoring.py            146    104    29%   53-62, 66, 141-142, 160-184, 198-256, 270-309, 325-343, 351-373, 387-418, 428, 450-480, 494-525
app\services\rules\time_rules.py         309    186    40%   32, 36, 40, 44, 48, 51-84, 92, 96, 100, 104, 108, 111-148, 156, 160, 164, 168, 172, 175-211, 219, 223, 227, 231, 235, 238-279, 287, 291, 295, 299, 303, 306-341, 349, 353, 357, 361, 365, 368-408, 416, 420, 424, 428, 432, 435-489, 497, 501, 505, 509, 513, 516-555, 563, 567, 571, 575, 579, 582-642, 650, 654, 658, 662, 666, 669-742, 751-772
app\services\validation_service.py       205    162    21%   41-54, 58-61, 108, 130-137, 150-191, 220-259, 288-326, 346-388, 408-433, 452-527, 550-579, 599-645, 673-693, 714-762
--------------------------------------------------------------------
TOTAL                                   8205   5408    34%
FAIL Required test coverage of 50% not reached. Total coverage: 34.09%
======================== 5 passed, 2 warnings in 5.83s ========================
