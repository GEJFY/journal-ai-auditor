# JAIA ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºä»•æ§˜æ›¸
## ã€œåˆå¿ƒè€…ã®ãŸã‚ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆãƒ»å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã€œ

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0
**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ
**å¯¾è±¡èª­è€…**: ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºåˆå¿ƒè€…ã€œä¸­ç´šè€…

---

## ç›®æ¬¡

1. [ã¯ã˜ã‚ã«](#1-ã¯ã˜ã‚ã«)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
3. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è©³ç´°](#3-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è©³ç´°)
4. [ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ­ã‚®ãƒ³ã‚°](#4-ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ­ã‚®ãƒ³ã‚°)
5. [ä¾‹å¤–å‡¦ç†è¨­è¨ˆ](#5-ä¾‹å¤–å‡¦ç†è¨­è¨ˆ)
6. [ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ï¼ˆTerraformï¼‰](#6-ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£terraform)
   - [6.1 Terraformã¨ã¯ï¼Ÿ](#61-terraformã¨ã¯)
   - [6.2 åŸºæœ¬çš„ãªæ§‹æ–‡](#62-åŸºæœ¬çš„ãªæ§‹æ–‡)
   - [6.3 AWSæ§‹æˆã®è§£èª¬](#63-awsæ§‹æˆã®è§£èª¬)
   - [6.4 AWSãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬](#64-awsãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬)
   - [6.5 Azureæ§‹æˆã®è§£èª¬](#65-azureæ§‹æˆã®è§£èª¬)
   - [6.6 Azureãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬](#66-azureãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬)
   - [6.7 GCPæ§‹æˆã®è§£èª¬](#67-gcpæ§‹æˆã®è§£èª¬)
   - [6.8 GCPãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬](#68-gcpãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬)
   - [6.9 ã‚¯ãƒ©ã‚¦ãƒ‰æ¯”è¼ƒã¾ã¨ã‚](#69-ã‚¯ãƒ©ã‚¦ãƒ‰æ¯”è¼ƒã¾ã¨ã‚)
   - [6.10 Terraformã‚³ãƒãƒ³ãƒ‰æ“ä½œ](#610-terraformã‚³ãƒãƒ³ãƒ‰æ“ä½œ)
7. [CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#7-cicdãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
8. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †](#8-ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †)
9. [é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#9-é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

---

## 1. ã¯ã˜ã‚ã«

### 1.1 ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚·ã‚¹ãƒ†ãƒ ã¨ã¯ï¼Ÿ

ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚·ã‚¹ãƒ†ãƒ ã¨ã¯ã€ä¼æ¥­ã‚„çµ„ç¹”ã§æ¥­å‹™ã«ä½¿ç”¨ã•ã‚Œã‚‹å¤§è¦æ¨¡ãªã‚·ã‚¹ãƒ†ãƒ ã®ã“ã¨ã§ã™ã€‚å€‹äººé–‹ç™ºã¨ç•°ãªã‚Šã€ä»¥ä¸‹ã®ç‰¹æ€§ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ï¼š

| ç‰¹æ€§ | èª¬æ˜ | å…·ä½“ä¾‹ |
|------|------|--------|
| **å¯ç”¨æ€§** | ã‚·ã‚¹ãƒ†ãƒ ãŒå¸¸ã«ç¨¼åƒã—ã¦ã„ã‚‹ | 99.9%ã®ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ä¿è¨¼ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰ã®ä¿è­· | èªè¨¼ã€æš—å·åŒ–ã€ç›£æŸ»ãƒ­ã‚° |
| **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£** | è² è·ã«å¿œã˜ãŸæ‹¡å¼µæ€§ | ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° |
| **ç›£æŸ»å¯èƒ½æ€§** | æ“ä½œå±¥æ­´ã®è¿½è·¡ | ç›£æŸ»ãƒ­ã‚°ã€å¤‰æ›´å±¥æ­´ |
| **é‹ç”¨æ€§** | ç›£è¦–ãƒ»ä¿å®ˆã®ã—ã‚„ã™ã• | ãƒ­ã‚°ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ã‚¢ãƒ©ãƒ¼ãƒˆ |

### 1.2 ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å­¦ã¹ã‚‹ã“ã¨

```
ğŸ“š å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
   â”‚
   â”œâ”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
   â”‚   â”œâ”€â”€ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ä»•çµ„ã¿
   â”‚   â”œâ”€â”€ IPãƒ–ãƒ­ãƒƒã‚¯ã®å®Ÿè£…
   â”‚   â””â”€â”€ æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
   â”‚
   â”œâ”€â”€ ãƒ­ã‚®ãƒ³ã‚°è¨­è¨ˆ
   â”‚   â”œâ”€â”€ æ§‹é€ åŒ–ãƒ­ã‚°
   â”‚   â”œâ”€â”€ ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
   â”‚   â””â”€â”€ æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ä¿è­·
   â”‚
   â”œâ”€â”€ ã‚¤ãƒ³ãƒ•ãƒ©è‡ªå‹•åŒ–
   â”‚   â”œâ”€â”€ TerraformåŸºç¤
   â”‚   â””â”€â”€ ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰å¯¾å¿œ
   â”‚
   â””â”€â”€ CI/CD
       â”œâ”€â”€ GitHub Actions
       â””â”€â”€ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 2.1 ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ                               â”‚
â”‚                    (ãƒ–ãƒ©ã‚¦ã‚¶ / Electronã‚¢ãƒ—ãƒª)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTPS
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ (ALB/LB)                        â”‚
â”‚                    ãƒ»SSLçµ‚ç«¯ ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚¹ã‚¿ãƒƒã‚¯                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£â”‚â†’â”‚IPãƒ–ãƒ­ãƒƒã‚¯ â”‚â†’â”‚ãƒ¬ãƒ¼ãƒˆåˆ¶é™ â”‚â†’â”‚ä¸æ­£æ¤œå‡º   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ãƒ˜ãƒƒãƒ€ãƒ¼   â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                        â†“                                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚    â”‚
â”‚  â”‚  â”‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â”‚â†’â”‚ç›£æŸ»ãƒ­ã‚°  â”‚â†’ APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ              â”‚    â”‚
â”‚  â”‚  â”‚ãƒ­ã‚®ãƒ³ã‚°   â”‚ â”‚           â”‚                               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ãƒ­ã‚¬ãƒ¼      â”‚  â”‚ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ â”‚  â”‚ LLMã‚µãƒ¼ãƒ“ã‚¹ â”‚                  â”‚
â”‚  â”‚ (JSONå½¢å¼)  â”‚  â”‚ (DuckDB)    â”‚  â”‚ (Bedrockç­‰) â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã¯ï¼Ÿ

**ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é–“ã«æŒŸã¾ã‚‹å‡¦ç†å±¤ã§ã™ã€‚

```python
# ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®åŸºæœ¬æ¦‚å¿µ
#
# ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ [ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢1] â†’ [ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢2] â†’ [APIå‡¦ç†] â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹
#                  â†“                    â†“
#              ãƒ­ã‚°è¨˜éŒ²            èªè¨¼ãƒã‚§ãƒƒã‚¯

# FastAPIã§ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®šç¾©
from starlette.middleware.base import BaseHTTPMiddleware

class MyMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request, call_next):
        # å‰å‡¦ç†ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡æ™‚ï¼‰
        print("ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã¾ã—ãŸ")

        # æ¬¡ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¾ãŸã¯APIãƒãƒ³ãƒ‰ãƒ©ã‚’å‘¼ã³å‡ºã—
        response = await call_next(request)

        # å¾Œå‡¦ç†ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹é€ä¿¡å‰ï¼‰
        print("ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã—ã¾ã™")

        return response
```

### 2.3 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè¡Œé †åº

**é‡è¦**: ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯**ç™»éŒ²é †ã¨é€†é †**ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

```python
# ç™»éŒ²é †åºï¼ˆã‚³ãƒ¼ãƒ‰ä¸Šã®é †åºï¼‰
app.add_middleware(AuditLogMiddleware)       # 6ç•ªç›®ã«ç™»éŒ²
app.add_middleware(RequestLoggingMiddleware)  # 5ç•ªç›®ã«ç™»éŒ²
app.add_middleware(SuspiciousActivityMiddleware)  # 4ç•ªç›®ã«ç™»éŒ²
app.add_middleware(RateLimitMiddleware)       # 3ç•ªç›®ã«ç™»éŒ²
app.add_middleware(IPBlockMiddleware)         # 2ç•ªç›®ã«ç™»éŒ²
app.add_middleware(SecurityHeadersMiddleware) # 1ç•ªç›®ã«ç™»éŒ²

# å®Ÿè¡Œé †åºï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ï¼‰
# 1. SecurityHeadersMiddlewareï¼ˆæœ€åˆã«å®Ÿè¡Œï¼‰
# 2. IPBlockMiddleware
# 3. RateLimitMiddleware
# 4. SuspiciousActivityMiddleware
# 5. RequestLoggingMiddleware
# 6. AuditLogMiddlewareï¼ˆæœ€å¾Œã«å®Ÿè¡Œï¼‰
```

ãªãœã“ã®é †åºãªã®ã‹ï¼Ÿ

```
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ  â†’ IPãƒ–ãƒ­ãƒƒã‚¯ç¢ºèª â†’ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
        â†“                     â†“                   â†“
    å¸¸ã«å¿…è¦           ãƒ–ãƒ­ãƒƒã‚¯ãªã‚‰å³æ‹’å¦    åˆ¶é™è¶…éãªã‚‰æ‹’å¦
```

---

## 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è©³ç´°

### 3.1 ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆRate Limitingï¼‰

#### 3.1.1 ãªãœãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒå¿…è¦ï¼Ÿ

```
å•é¡Œã‚·ãƒŠãƒªã‚ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ1ç§’é–“ã«1000å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡           â”‚
â”‚                    â†“                                         â”‚
â”‚ ã‚µãƒ¼ãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡ â†’ ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„       â”‚
â”‚                    â†“                                         â”‚
â”‚ ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼ˆDoSæ”»æ’ƒæˆåŠŸï¼‰                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§£æ±ºç­–ï¼šãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒä¸€IPã‹ã‚‰60ç§’é–“ã«100å›ã‚’è¶…ãˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‹’å¦             â”‚
â”‚                    â†“                                         â”‚
â”‚ æ­£å¸¸ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å½±éŸ¿ãªã—ã€æ”»æ’ƒè€…ã¯ãƒ–ãƒ­ãƒƒã‚¯                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2 ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ–¹å¼

JAIAã§ã¯ã€Œã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€æ–¹å¼ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

```
å›ºå®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ–¹å¼ï¼ˆæ¡ç”¨ã—ã¦ã„ãªã„ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0:00 - 1:00   â”‚  1:00 - 2:00   â”‚
â”‚   100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â”‚   100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å•é¡Œ: 0:59ã«100å›ã€1:01ã«100å› â†’ 2ç§’ã§200å›ãŒé€šé

ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ–¹å¼ï¼ˆJAIAãŒæ¡ç”¨ï¼‰:
ç¾åœ¨æ™‚åˆ»ã‹ã‚‰éå»60ç§’é–“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† 60ç§’ â†’                                               â”‚
â”‚  [ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´: 12:00:05, 12:00:15, 12:00:45, ...]   â”‚
â”‚  ç¾åœ¨æ™‚åˆ»: 12:01:00                                     â”‚
â”‚  æœ‰åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 12:00:00ä»¥é™ã®ã‚‚ã®ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.3 å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

```python
class RateLimiter:
    """
    ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ–¹å¼ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™

    ãƒ‡ãƒ¼ã‚¿æ§‹é€ :
        requests = {
            "192.168.1.1": [1707350400.0, 1707350401.5, 1707350402.3],
            "192.168.1.2": [1707350400.5, 1707350403.0],
        }
        # IPã‚¢ãƒ‰ãƒ¬ã‚¹ã”ã¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚åˆ»ã®ãƒªã‚¹ãƒˆã‚’ä¿æŒ
    """

    def __init__(
        self,
        max_requests: int = 100,      # æœ€å¤§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
        window_seconds: int = 60,      # æ™‚é–“ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆç§’ï¼‰
    ):
        self.max_requests = max_requests
        self.window_seconds = window_seconds
        self.requests: Dict[str, List[float]] = defaultdict(list)
        self.lock = Lock()  # ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã®ãŸã‚ã®ãƒ­ãƒƒã‚¯

    def is_allowed(self, client_id: str) -> bool:
        """
        ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¨±å¯ã•ã‚Œã‚‹ã‹ã‚’åˆ¤å®š

        å‡¦ç†ãƒ•ãƒ­ãƒ¼:
        1. ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
        2. ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–‹å§‹æ™‚åˆ»ã‚’è¨ˆç®—ï¼ˆç¾åœ¨ - 60ç§’ï¼‰
        3. å¤ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´ã‚’å‰Šé™¤
        4. ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯
        5. è¨±å¯ãªã‚‰ç¾åœ¨æ™‚åˆ»ã‚’è¿½åŠ 
        """
        now = time.time()  # ä¾‹: 1707350460.0
        window_start = now - self.window_seconds  # ä¾‹: 1707350400.0

        with self.lock:  # è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åŒæ™‚å‡¦ç†å¯¾ç­–
            # Step 3: å¤ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‰Šé™¤
            self.requests[client_id] = [
                ts for ts in self.requests[client_id]
                if ts > window_start  # 60ç§’ä»¥å†…ã®ã‚‚ã®ã®ã¿æ®‹ã™
            ]

            # Step 4: åˆ¶é™ãƒã‚§ãƒƒã‚¯
            if len(self.requests[client_id]) >= self.max_requests:
                return False  # åˆ¶é™è¶…é

            # Step 5: ç¾åœ¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨˜éŒ²
            self.requests[client_id].append(now)
            return True  # è¨±å¯
```

#### 3.1.4 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼

åˆ¶é™æƒ…å ±ã¯HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã§è¿”ã•ã‚Œã¾ã™ï¼š

```http
HTTP/1.1 200 OK
X-RateLimit-Limit: 100           â† æœ€å¤§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
X-RateLimit-Remaining: 95        â† æ®‹ã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°

HTTP/1.1 429 Too Many Requests   â† åˆ¶é™è¶…éæ™‚
Retry-After: 45                  â† ä½•ç§’å¾Œã«å†è©¦è¡Œå¯èƒ½ã‹
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
```

### 3.2 IPãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½

#### 3.2.1 2ç¨®é¡ã®ãƒ–ãƒ­ãƒƒã‚¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ°¸ä¹…ãƒ–ãƒ­ãƒƒã‚¯                                                 â”‚
â”‚ ãƒ»ç®¡ç†è€…ãŒæ‰‹å‹•ã§è¨­å®š                                         â”‚
â”‚ ãƒ»æ—¢çŸ¥ã®æ‚ªæ„ã‚ã‚‹IPã‚’äº‹å‰ç™»éŒ²                                â”‚
â”‚ ãƒ»ä¾‹: æ”»æ’ƒå…ƒã¨ã—ã¦å ±å‘Šã•ã‚ŒãŸIP                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆè‡ªå‹•ï¼‰                                         â”‚
â”‚ ãƒ»é•åã‚’10å›ç¹°ã‚Šè¿”ã™ã¨15åˆ†é–“ãƒ–ãƒ­ãƒƒã‚¯                        â”‚
â”‚ ãƒ»ä¸æ­£ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œå‡ºæ™‚ã«ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ                         â”‚
â”‚ ãƒ»æœŸé™åˆ‡ã‚Œå¾Œã¯è‡ªå‹•è§£é™¤                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2 å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

```python
class IPBlockManager:
    """IPãƒ–ãƒ­ãƒƒã‚¯ç®¡ç†ã‚¯ãƒ©ã‚¹"""

    def __init__(self):
        # æ°¸ä¹…ãƒ–ãƒ­ãƒƒã‚¯IPã‚»ãƒƒãƒˆ
        self.permanent_blocks: Set[str] = set()

        # ä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆIP â†’ è§£é™¤æ™‚åˆ»ã®ãƒãƒƒãƒ—ï¼‰
        self.temp_blocks: Dict[str, datetime] = {}
        # ä¾‹: {"192.168.1.100": datetime(2026, 2, 8, 15, 30)}

        # é•åå›æ•°ã‚«ã‚¦ãƒ³ãƒˆ
        self.violation_counts: Dict[str, int] = defaultdict(int)
        # ä¾‹: {"192.168.1.100": 5, "192.168.1.101": 2}

    def is_blocked(self, ip: str) -> bool:
        """ãƒ–ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ç¢ºèª"""
        # æ°¸ä¹…ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
        if ip in self.permanent_blocks:
            return True

        # ä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
        if ip in self.temp_blocks:
            if datetime.now() < self.temp_blocks[ip]:
                return True  # ã¾ã ãƒ–ãƒ­ãƒƒã‚¯æœŸé–“ä¸­
            else:
                # ãƒ–ãƒ­ãƒƒã‚¯æœŸé™åˆ‡ã‚Œ â†’ è§£é™¤
                del self.temp_blocks[ip]
                self.violation_counts[ip] = 0

        return False

    def record_violation(self, ip: str) -> None:
        """é•åã‚’è¨˜éŒ²"""
        self.violation_counts[ip] += 1

        # é–¾å€¤ã‚’è¶…ãˆãŸã‚‰ä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯
        if self.violation_counts[ip] >= 10:  # TEMP_BLOCK_THRESHOLD
            self.temp_blocks[ip] = datetime.now() + timedelta(minutes=15)
            # ãƒ­ã‚°å‡ºåŠ›: "IPä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯: 192.168.1.100ï¼ˆé•åå›æ•°: 10ï¼‰"
```

### 3.3 ä¸æ­£ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œå‡º

#### 3.3.1 æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³

```python
SUSPICIOUS_PATTERNS = [
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒ
    "../",       # ä¸Šä½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œ
    "..\\",      # Windowså½¢å¼

    # XSSï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°ï¼‰
    "<script",   # JavaScriptã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
    "</script>",

    # SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
    "' OR ",     # ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ + ORæ¡ä»¶
    "\" OR ",    # ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ + ORæ¡ä»¶

    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
    "${",        # å¤‰æ•°å±•é–‹ï¼ˆJavaãªã©ï¼‰
    "#{",        # å¼è¨€èª
    "{{", "}}",  # Jinja2/Mustacheãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
]
```

#### 3.3.2 æ”»æ’ƒä¾‹ã¨æ¤œå‡º

```
æ”»æ’ƒä¾‹1: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«
URL: /api/v1/files?path=../../etc/passwd
           æ¤œå‡º: "../" ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒ
           çµæœ: 400 Bad Request + é•åè¨˜éŒ²

æ”»æ’ƒä¾‹2: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
URL: /api/v1/users?id=1' OR '1'='1
           æ¤œå‡º: "' OR " ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒ
           çµæœ: 400 Bad Request + é•åè¨˜éŒ²

æ”»æ’ƒä¾‹3: XSS
URL: /api/v1/search?q=<script>alert('XSS')</script>
           æ¤œå‡º: "<script" ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒ
           çµæœ: 400 Bad Request + é•åè¨˜éŒ²
```

### 3.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

#### 3.4.1 å„ãƒ˜ãƒƒãƒ€ãƒ¼ã®å½¹å‰²

```python
SECURITY_HEADERS = {
    # MIMEã‚¿ã‚¤ãƒ—ã‚¹ãƒ‹ãƒƒãƒ•ã‚£ãƒ³ã‚°å¯¾ç­–
    "X-Content-Type-Options": "nosniff",
    # ãƒ–ãƒ©ã‚¦ã‚¶ãŒContent-Typeã‚’å‹æ‰‹ã«æ¨æ¸¬ã—ãªã„
    # ä¾‹: text/htmlã¨å½è£…ã—ãŸJSãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œã‚’é˜²æ­¢

    # ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°å¯¾ç­–
    "X-Frame-Options": "DENY",
    # ã“ã®ãƒšãƒ¼ã‚¸ã‚’iframeå†…ã«åŸ‹ã‚è¾¼ã‚€ã“ã¨ã‚’ç¦æ­¢
    # é€æ˜ãªiframeã‚’é‡ã­ã¦ã‚¯ãƒªãƒƒã‚¯ã•ã›ã‚‹æ”»æ’ƒã‚’é˜²æ­¢

    # XSSãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœ‰åŠ¹åŒ–
    "X-XSS-Protection": "1; mode=block",
    # ãƒ–ãƒ©ã‚¦ã‚¶å†…è”µã®XSSãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æœ‰åŠ¹åŒ–
    # æ”»æ’ƒæ¤œå‡ºæ™‚ã¯ãƒšãƒ¼ã‚¸è¡¨ç¤ºã‚’ãƒ–ãƒ­ãƒƒã‚¯

    # HTTPSå¼·åˆ¶ï¼ˆHSTSï¼‰
    "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
    # 1å¹´é–“ã€ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®æ¥ç¶šã¯å¿…ãšHTTPSã‚’ä½¿ç”¨
    # ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚‚å«ã‚€

    # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼
    "Content-Security-Policy": "default-src 'self'; ...",
    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å…ƒã‚’åˆ¶é™
    # å¤–éƒ¨ã‹ã‚‰ã®æ‚ªæ„ã‚ã‚‹ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã‚’é˜²æ­¢

    # ãƒªãƒ•ã‚¡ãƒ©ãƒ¼åˆ¶å¾¡
    "Referrer-Policy": "strict-origin-when-cross-origin",
    # åˆ¥ã‚µã‚¤ãƒˆã¸ã®ãƒªãƒ³ã‚¯æ™‚ã€ã‚ªãƒªã‚¸ãƒ³æƒ…å ±ã®ã¿é€ä¿¡
    # ãƒ‘ã‚¹æƒ…å ±ã®æ¼æ´©ã‚’é˜²æ­¢

    # æ©Ÿèƒ½åˆ¶é™
    "Permissions-Policy": "geolocation=(), microphone=(), camera=()",
    # ä½ç½®æƒ…å ±ãƒ»ãƒã‚¤ã‚¯ãƒ»ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢
}
```

---

## 4. ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ­ã‚®ãƒ³ã‚°

### 4.1 ãƒ­ã‚°ã®ç¨®é¡ã¨ç”¨é€”

```
logs/
â”œâ”€â”€ jaia.log              # ãƒ¡ã‚¤ãƒ³ãƒ­ã‚°ï¼ˆå…¨èˆ¬ï¼‰
â”‚   â””â”€â”€ ç”¨é€”: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œç¢ºèªã€ãƒ‡ãƒãƒƒã‚°
â”‚   â””â”€â”€ ä¿æŒ: 10MB Ã— 10ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ jaia_error.log        # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
â”‚   â””â”€â”€ ç”¨é€”: éšœå®³èª¿æŸ»ã€ãƒã‚°ä¿®æ­£
â”‚   â””â”€â”€ ä¿æŒ: 10MB Ã— 10ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ jaia_audit.log        # ç›£æŸ»ãƒ­ã‚°
â”‚   â””â”€â”€ ç”¨é€”: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
â”‚   â””â”€â”€ ä¿æŒ: 90æ—¥é–“ï¼ˆæ—¥æ¬¡ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”‚
â”œâ”€â”€ jaia_security.log     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°
â”‚   â””â”€â”€ ç”¨é€”: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥ã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ
â”‚   â””â”€â”€ ä¿æŒ: 365æ—¥é–“ï¼ˆã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ï¼‰
â”‚
â””â”€â”€ jaia_performance.log  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°
    â””â”€â”€ ç”¨é€”: æ€§èƒ½ç›£è¦–ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š
    â””â”€â”€ ä¿æŒ: 50MB Ã— 5ãƒ•ã‚¡ã‚¤ãƒ«
```

### 4.2 æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰

#### 4.2.1 ãªãœJSONå½¢å¼ãªã®ã‹ï¼Ÿ

```
å¾“æ¥ã®ãƒ­ã‚°ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰:
2026-02-08 10:30:45 INFO ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†å®Œäº† user=u001 duration=150ms

å•é¡Œç‚¹:
ãƒ»ãƒ‘ãƒ¼ã‚¹ãŒå›°é›£ï¼ˆæ­£è¦è¡¨ç¾ãŒå¿…è¦ï¼‰
ãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ãƒ»å‰Šé™¤ã§è§£æãŒå£Šã‚Œã‚‹
ãƒ»ãƒ­ã‚°åˆ†æãƒ„ãƒ¼ãƒ«ã¨ã®é€£æºãŒå›°é›£

JSONå½¢å¼ã®ãƒ­ã‚°:
{
  "timestamp": "2026-02-08T10:30:45.123Z",
  "level": "INFO",
  "message": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†å®Œäº†",
  "user_id": "u001",
  "duration_ms": 150,
  "request_id": "abc12345"
}

åˆ©ç‚¹:
ãƒ»æ©Ÿæ¢°çš„ãªãƒ‘ãƒ¼ã‚¹ãŒå®¹æ˜“
ãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ãƒ»å‰Šé™¤ãŒå®‰å…¨
ãƒ»ELK Stackã€CloudWatchç­‰ã¨ã®é€£æºãŒç°¡å˜
```

#### 4.2.2 JSONãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã®å®Ÿè£…

```python
class JSONFormatter(logging.Formatter):
    """JSONå½¢å¼ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼"""

    def format(self, record: logging.LogRecord) -> str:
        # åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        log_data = {
            "timestamp": datetime.utcnow().isoformat() + "Z",
            "level": record.levelname,      # INFO, WARNING, ERRORç­‰
            "logger": record.name,          # app.services.llmç­‰
            "message": record.getMessage(), # ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            "request_id": getattr(record, "request_id", "no-request-id"),
            "module": record.module,        # ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«å
            "function": record.funcName,    # é–¢æ•°å
            "line": record.lineno,          # è¡Œç•ªå·
        }

        # ä¾‹å¤–æƒ…å ±ï¼ˆã‚ã‚Œã°ï¼‰
        if record.exc_info:
            log_data["exception"] = self.formatException(record.exc_info)

        # è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆextraã§æ¸¡ã•ã‚ŒãŸã‚‚ã®ï¼‰
        extra_fields = ["user_id", "duration_ms", "status_code", ...]
        for field in extra_fields:
            if hasattr(record, field):
                log_data[field] = getattr(record, field)

        return json.dumps(log_data, ensure_ascii=False)
```

### 4.3 æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¹ã‚­ãƒ³ã‚°

#### 4.3.1 ãªãœãƒã‚¹ã‚­ãƒ³ã‚°ãŒå¿…è¦ï¼Ÿ

```
å•é¡Œã‚·ãƒŠãƒªã‚ª:
logger.error(f"APIå‘¼ã³å‡ºã—å¤±æ•—: key={api_key}")
     â†“
ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«å¹³æ–‡ã§APIã‚­ãƒ¼ãŒè¨˜éŒ²ã•ã‚Œã‚‹
     â†“
ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¼æ´©ã™ã‚‹ã¨å…¨APIã‚­ãƒ¼ãŒæµå‡º

è§£æ±ºç­–:
è‡ªå‹•ãƒã‚¹ã‚­ãƒ³ã‚°ã«ã‚ˆã‚Šæ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·
```

#### 4.3.2 ãƒã‚¹ã‚­ãƒ³ã‚°å¯¾è±¡ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
class SensitiveDataFilter(logging.Filter):
    """æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚¹ã‚­ãƒ³ã‚°ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"""

    # ãƒã‚¹ã‚­ãƒ³ã‚°å¯¾è±¡ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
    patterns = [
        # Anthropic APIã‚­ãƒ¼
        (r'(sk-ant-[a-zA-Z0-9-]{10,})', r'sk-ant-***MASKED***'),
        # å…¥åŠ›: sk-ant-api03-abcdefghijklmnop
        # å‡ºåŠ›: sk-ant-***MASKED***

        # OpenAI APIã‚­ãƒ¼
        (r'(sk-proj-[a-zA-Z0-9-]{10,})', r'sk-proj-***MASKED***'),

        # AWS ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼
        (r'(AKIA[A-Z0-9]{12,})', r'AKIA***MASKED***'),
        # å…¥åŠ›: AKIAIOSFODNN7EXAMPLE
        # å‡ºåŠ›: AKIA***MASKED***

        # Google APIã‚­ãƒ¼
        (r'(AIzaSy[a-zA-Z0-9_-]{20,})', r'AIzaSy***MASKED***'),

        # ä¸€èˆ¬çš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰/ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
        (r'password[:=]\s*["\']?([^"\'\s]+)', r'password=***MASKED***'),
    ]
```

### 4.4 ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

#### 4.4.1 ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã¨ã¯ï¼Ÿ

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹/é–¢æ•°ã‚’çµŒç”± â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹

å•é¡Œ: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã€ã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã©ã®å‡¦ç†ã§èµ·ããŸï¼Ÿ

è§£æ±ºç­–: ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã§å…¨ãƒ­ã‚°ã‚’ç´ä»˜ã‘

[abc12345] 10:30:45 ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹: POST /api/v1/import
[abc12345] 10:30:45 ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼é–‹å§‹
[abc12345] 10:30:46 ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å®Œäº†
[abc12345] 10:30:46 ãƒ‡ãƒ¼ã‚¿å¤‰æ›é–‹å§‹
[abc12345] 10:30:47 ã‚¨ãƒ©ãƒ¼: ã‚«ãƒ©ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°å¤±æ•—  â† ã“ã“ã§å•é¡Œç™ºç”Ÿ
[abc12345] 10:30:47 ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†: 400
```

#### 4.4.2 å®Ÿè£…æ–¹æ³•

```python
from contextvars import ContextVar

# ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªå¤‰æ•°ï¼ˆéåŒæœŸå‡¦ç†ã§ã‚‚å®‰å…¨ï¼‰
request_id_var: ContextVar[str | None] = ContextVar("request_id", default=None)

def set_request_id(request_id: str | None = None) -> str:
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’è¨­å®š"""
    if request_id is None:
        request_id = str(uuid.uuid4())[:8]  # 8æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ ID
    request_id_var.set(request_id)
    return request_id

def get_request_id() -> str:
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’å–å¾—"""
    return request_id_var.get() or "no-request-id"

# ãƒ­ã‚°å‡ºåŠ›æ™‚ã«è‡ªå‹•ä»˜ä¸
class RequestIdFilter(logging.Filter):
    def filter(self, record):
        record.request_id = get_request_id()
        return True
```

---

## 5. ä¾‹å¤–å‡¦ç†è¨­è¨ˆ

### 5.1 ä¾‹å¤–ã‚¯ãƒ©ã‚¹éšå±¤

```
JAIAExceptionï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰
â”‚
â”œâ”€â”€ ValidationErrorï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚   â”œâ”€â”€ FileValidationErrorï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚   â”œâ”€â”€ DataValidationErrorï¼ˆãƒ‡ãƒ¼ã‚¿å€¤ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚   â””â”€â”€ ColumnMappingErrorï¼ˆã‚«ãƒ©ãƒ ãƒãƒƒãƒ”ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚
â”œâ”€â”€ SecurityErrorï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚   â”œâ”€â”€ AuthenticationErrorï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ï¼‰â†’ 401
â”‚   â”œâ”€â”€ IPBlockedErrorï¼ˆIPãƒ–ãƒ­ãƒƒã‚¯ï¼‰â†’ 403
â”‚   â””â”€â”€ SuspiciousActivityErrorï¼ˆä¸æ­£æ¤œå‡ºï¼‰â†’ 403
â”‚
â”œâ”€â”€ RateLimitErrorï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼‰â†’ 429
â”‚
â”œâ”€â”€ AgentErrorï¼ˆAIé–¢é€£ã‚¨ãƒ©ãƒ¼ï¼‰
â”‚   â””â”€â”€ LLMProviderErrorï¼ˆLLM API ã‚¨ãƒ©ãƒ¼ï¼‰â†’ 503
â”‚
â””â”€â”€ CircuitBreakerErrorï¼ˆã‚µãƒ¼ãƒ“ã‚¹é®æ–­ï¼‰â†’ 503
```

### 5.2 ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆåŸå‰‡

```python
class JAIAException(Exception):
    """JAIAåŸºåº•ä¾‹å¤–ã‚¯ãƒ©ã‚¹"""

    # ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    error_code: str = "JAIA_ERROR"
    http_status_code: int = 500

    def __init__(
        self,
        message: str,                    # äººé–“ãŒèª­ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        error_code: str | None = None,   # æ©Ÿæ¢°å‡¦ç†ç”¨ã‚³ãƒ¼ãƒ‰
        detail: dict | None = None,      # è¿½åŠ æƒ…å ±
        http_status_code: int | None = None
    ):
        super().__init__(message)
        self.message = message
        if error_code:
            self.error_code = error_code
        if http_status_code:
            self.http_status_code = http_status_code
        self.detail = detail or {}

    def to_dict(self) -> dict:
        """APIå¿œç­”ç”¨ã®è¾æ›¸ã«å¤‰æ›"""
        return {
            "error_code": self.error_code,
            "message": self.message,
            "detail": self.detail
        }
```

### 5.3 ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

```python
# ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ã‚’FastAPIã«ç™»éŒ²
app.add_exception_handler(JAIAException, jaia_exception_handler)
app.add_exception_handler(Exception, generic_exception_handler)

async def jaia_exception_handler(request, exc: JAIAException):
    """JAIAä¾‹å¤–ã‚’JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¤‰æ›"""
    return JSONResponse(
        status_code=exc.http_status_code,
        content={
            "success": False,
            "error": exc.to_dict(),
            "meta": {
                "request_id": get_request_id(),
                "timestamp": datetime.utcnow().isoformat() + "Z",
            }
        }
    )

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
# {
#   "success": false,
#   "error": {
#     "error_code": "RATE_LIMIT_EXCEEDED",
#     "message": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒåˆ¶é™ã‚’è¶…ãˆã¾ã—ãŸ",
#     "detail": {"limit": 100, "window_seconds": 60}
#   },
#   "meta": {
#     "request_id": "abc12345",
#     "timestamp": "2026-02-08T10:30:45Z"
#   }
# }
```

---

## 6. ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ï¼ˆTerraformï¼‰

### 6.1 Terraformã¨ã¯ï¼Ÿ

```
Terraform = ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰ã§å®šç¾©ã™ã‚‹ãƒ„ãƒ¼ãƒ«

å¾“æ¥ã®æ–¹æ³•:
1. AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
3. æ‰‹é †æ›¸ã‚’ä½œæˆï¼ˆã™ãå¤ããªã‚‹ï¼‰
4. ç’°å¢ƒå·®ç•°ãŒç™ºç”Ÿï¼ˆé–‹ç™ºã¨æœ¬ç•ªã§é•ã†ï¼‰

Terraformã‚’ä½¿ã†æ–¹æ³•:
1. ã‚³ãƒ¼ãƒ‰ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©
2. `terraform apply` ã§è‡ªå‹•ä½œæˆ
3. ã‚³ãƒ¼ãƒ‰ãŒæ‰‹é †æ›¸ï¼ˆå¸¸ã«æœ€æ–°ï¼‰
4. åŒã˜ã‚³ãƒ¼ãƒ‰ã§åŒã˜ç’°å¢ƒã‚’å†ç¾å¯èƒ½
```

### 6.2 åŸºæœ¬çš„ãªæ§‹æ–‡

```hcl
# Terraformè¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (.tf)

# ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šï¼ˆã©ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’ä½¿ã†ã‹ï¼‰
provider "aws" {
  region = "us-east-1"
}

# å¤‰æ•°å®šç¾©
variable "environment" {
  description = "ç’°å¢ƒå"
  type        = string
  default     = "development"
}

# ãƒªã‚½ãƒ¼ã‚¹å®šç¾©
resource "aws_s3_bucket" "data" {
  bucket = "jaia-${var.environment}-data"

  tags = {
    Name        = "JAIA Data Bucket"
    Environment = var.environment
  }
}

# å‡ºåŠ›å€¤
output "bucket_name" {
  value = aws_s3_bucket.data.id
}
```

### 6.3 AWSæ§‹æˆã®è§£èª¬

```hcl
# infrastructure/terraform/aws/main.tf

# ===========================================
# VPCï¼ˆä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
# ===========================================
module "vpc" {
  source = "../modules/vpc"

  name       = "jaia-production"
  cidr_block = "10.0.0.0/16"  # ç´„65,000å€‹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹

  # å¯ç”¨æ€§ã®ãŸã‚2ã¤ã®ã‚¾ãƒ¼ãƒ³ã‚’ä½¿ç”¨
  availability_zones = ["us-east-1a", "us-east-1b"]

  # ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šå¯ï¼‰
  public_subnets = ["10.0.1.0/24", "10.0.2.0/24"]

  # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆï¼ˆå†…éƒ¨é€šä¿¡ã®ã¿ï¼‰
  private_subnets = ["10.0.10.0/24", "10.0.20.0/24"]
}

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³:
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ VPC: 10.0.0.0/16                                        â”‚
# â”‚                                                         â”‚
# â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
# â”‚  â”‚ Public Subnet    â”‚  â”‚ Public Subnet    â”‚            â”‚
# â”‚  â”‚ 10.0.1.0/24      â”‚  â”‚ 10.0.2.0/24      â”‚            â”‚
# â”‚  â”‚ (us-east-1a)     â”‚  â”‚ (us-east-1b)     â”‚            â”‚
# â”‚  â”‚     ALB â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ALB        â”‚  â† ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ
# â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
# â”‚           â”‚                      â”‚                      â”‚
# â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
# â”‚  â”‚ Private Subnet   â”‚  â”‚ Private Subnet   â”‚            â”‚
# â”‚  â”‚ 10.0.10.0/24     â”‚  â”‚ 10.0.20.0/24     â”‚            â”‚
# â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚            â”‚
# â”‚  â”‚  â”‚ ECS Task    â”‚ â”‚  â”‚  â”‚ ECS Task    â”‚ â”‚            â”‚
# â”‚  â”‚  â”‚ (Backend)   â”‚ â”‚  â”‚  â”‚ (Backend)   â”‚ â”‚            â”‚
# â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚            â”‚
# â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# ===========================================
# ECSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œç’°å¢ƒï¼‰
# ===========================================
resource "aws_ecs_cluster" "main" {
  name = "jaia-production"

  setting {
    name  = "containerInsights"
    value = "enabled"  # CloudWatchã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–
  }
}

# ===========================================
# IAMãƒ­ãƒ¼ãƒ«ï¼ˆBedrockã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ï¼‰
# ===========================================
resource "aws_iam_role_policy" "bedrock_access" {
  name = "bedrock-access"
  role = aws_iam_role.ecs_task_role.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "bedrock:InvokeModel",           # ãƒ¢ãƒ‡ãƒ«å‘¼ã³å‡ºã—
          "bedrock:InvokeModelWithResponseStream",  # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
        ]
        Resource = [
          "arn:aws:bedrock:us-east-1::foundation-model/anthropic.*"
        ]
      }
    ]
  })
}

# æ¨©é™ã®è€ƒãˆæ–¹ï¼ˆæœ€å°æ¨©é™ã®åŸå‰‡ï¼‰:
# ãƒ»å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸
# ãƒ»bedrock:* ã§ã¯ãªãã€InvokeModel ã®ã¿
# ãƒ»å…¨ãƒªã‚½ãƒ¼ã‚¹ã§ã¯ãªãã€Anthropicãƒ¢ãƒ‡ãƒ«ã®ã¿
```

### 6.4 AWSãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬

JAIAã®AWSç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã‚‹å„ãƒªã‚½ãƒ¼ã‚¹ã®å½¹å‰²ã¨è¨­è¨ˆæ„å›³ã‚’è§£èª¬ã—ã¾ã™ã€‚

#### 6.4.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VPC (Virtual Private Cloud)                  â”‚
â”‚                                                                     â”‚
â”‚  ã€Œã‚ãªãŸå°‚ç”¨ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€                            â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Internet Gateway                                              â”‚   â”‚
â”‚  â”‚ ã€ŒVPCã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ç¹‹ãç„é–¢ã€                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Public Subnets    â”‚                                â”‚   â”‚
â”‚  â”‚  ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªé ˜åŸŸã€                    â”‚   â”‚
â”‚  â”‚  ãƒ»ALBï¼ˆãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ï¼‰ã‚’é…ç½®                            â”‚   â”‚
â”‚  â”‚  ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚       Private Subnets    â”‚                                â”‚   â”‚
â”‚  â”‚  ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„å®‰å…¨ãªé ˜åŸŸã€        â”‚   â”‚
â”‚  â”‚  ãƒ»ECSã‚¿ã‚¹ã‚¯ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’é…ç½®                      â”‚   â”‚
â”‚  â”‚  ãƒ»å¤–éƒ¨ã¸ã¯NAT GatewayçµŒç”±                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ãƒªã‚½ãƒ¼ã‚¹ | å½¹å‰² | JAIAã§ã®ç”¨é€” |
| -------- | ---- | ------------ |
| **VPC** | ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | JAIAå°‚ç”¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç©ºé–“ã‚’ç¢ºä¿ |
| **Subnet** | VPCå†…ã®IPç¯„å›²ã®åŒºç”» | Public/Privateã§å½¹å‰²ã‚’åˆ†é›¢ |
| **Internet Gateway** | VPCã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®æ¥ç¶šç‚¹ | å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ã‘å…¥ã‚Œ |
| **NAT Gateway** | Privateã‚µãƒ–ãƒãƒƒãƒˆã‹ã‚‰ã®å¤–éƒ¨é€šä¿¡ | LLM APIå‘¼ã³å‡ºã—æ™‚ã«ä½¿ç”¨ |
| **Route Table** | é€šä¿¡çµŒè·¯ã®å®šç¾© | ã©ã“ã«ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ã‚‹ã‹æ±ºå®š |

#### 6.4.2 ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚½ãƒ¼ã‚¹

```
ECS (Elastic Container Service) ã®æ§‹é€ 

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ECS Cluster                               â”‚
â”‚  ã€Œã‚³ãƒ³ãƒ†ãƒŠã‚’ç®¡ç†ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã€                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      ECS Service                          â”‚   â”‚
â”‚  â”‚  ã€Œå¸¸ã«æŒ‡å®šæ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¶­æŒã™ã‚‹ä»•çµ„ã¿ã€                  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  ECS Task   â”‚  â”‚  ECS Task   â”‚  â”‚  ECS Task   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ (Container) â”‚  â”‚ (Container) â”‚  â”‚ (Container) â”‚       â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ JAIA    â”‚ â”‚  â”‚ â”‚ JAIA    â”‚ â”‚  â”‚ â”‚ JAIA    â”‚ â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Backend â”‚ â”‚  â”‚ â”‚ Backend â”‚ â”‚  â”‚ â”‚ Backend â”‚ â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â†’ 1ã¤è½ã¡ã¦ã‚‚è‡ªå‹•ã§æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’èµ·å‹•                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ãƒªã‚½ãƒ¼ã‚¹ | å½¹å‰² | è¨­å®šå€¤ã®æ„å‘³ |
| -------- | ---- | ------------ |
| **ECS Cluster** | ã‚³ãƒ³ãƒ†ãƒŠã®ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç† | containerInsights=enabled ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† |
| **ECS Service** | å¸¸ã«æŒ‡å®šæ•°ã®ã‚¿ã‚¹ã‚¯ã‚’ç¶­æŒ | desiredCount=2 ãªã‚‰å¸¸ã«2ã¤ç¨¼åƒ |
| **ECS Task** | å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠ | JAIAãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå‹•ä½œ |
| **Task Definition** | ã‚³ãƒ³ãƒ†ãƒŠã®è¨­è¨ˆå›³ | CPUã€ãƒ¡ãƒ¢ãƒªã€ç’°å¢ƒå¤‰æ•°ç­‰ã‚’å®šç¾© |

#### 6.4.3 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

```python
# S3 (Simple Storage Service) - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

# ç”¨é€”ä¾‹:
# ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸä»•è¨³ãƒ‡ãƒ¼ã‚¿ã®ä¿ç®¡
# ãƒ»ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆã®ä¿å­˜
# ãƒ»ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

resource "aws_s3_bucket" "data" {
    bucket = "jaia-production-data-123456789012"
    # ãƒã‚±ãƒƒãƒˆåã¯å…¨ä¸–ç•Œã§ãƒ¦ãƒ‹ãƒ¼ã‚¯

    # ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°: ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´å±¥æ­´ã‚’ä¿æŒ
    versioning {
        status = "Enabled"
    }

    # æš—å·åŒ–: ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æš—å·åŒ–
    server_side_encryption_configuration {
        rule {
            apply_server_side_encryption_by_default {
                sse_algorithm = "AES256"
            }
        }
    }
}

# Secrets Manager - ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

# ç”¨é€”:
# ãƒ»APIã‚­ãƒ¼ã®å®‰å…¨ãªä¿ç®¡
# ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
# ãƒ»ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£èªè¨¼æƒ…å ±

resource "aws_secretsmanager_secret" "app_secrets" {
    name = "jaia/production/secrets"
    # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯è‡ªå‹•çš„ã«æš—å·åŒ–ã•ã‚Œã‚‹
    # ã‚¢ã‚¯ã‚»ã‚¹ã¯IAMã§åˆ¶å¾¡
}
```

| ãƒªã‚½ãƒ¼ã‚¹ | å½¹å‰² | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ |
| -------- | ---- | ---------------- |
| **S3** | ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ | æš—å·åŒ–ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |
| **Secrets Manager** | æ©Ÿå¯†æƒ…å ±ç®¡ç† | è‡ªå‹•æš—å·åŒ–ã€ã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»ã€è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ |
| **ECR** | Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ä¿ç®¡ | ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã€æš—å·åŒ– |

#### 6.4.4 ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°

```
Application Load Balancer (ALB) ã®å‹•ä½œ

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ALB (ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼)                    â”‚
â”‚                                                             â”‚
â”‚  æ©Ÿèƒ½:                                                      â”‚
â”‚  1. SSL/TLSçµ‚ç«¯ï¼ˆHTTPSæš—å·åŒ–ã‚’è§£é™¤ï¼‰                        â”‚
â”‚  2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆæ­£å¸¸ãªã‚µãƒ¼ãƒãƒ¼ã®ã¿ã«è»¢é€ï¼‰              â”‚
â”‚  3. è² è·åˆ†æ•£ï¼ˆè¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ã«å‡ç­‰ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé…åˆ†ï¼‰          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Listener: Port 443 (HTTPS)                          â”‚    â”‚
â”‚  â”‚    â†“                                                â”‚    â”‚
â”‚  â”‚ Target Group: jaia-backend (Port 8001)              â”‚    â”‚
â”‚  â”‚    â†“                                                â”‚    â”‚
â”‚  â”‚ Health Check: GET /api/v1/health every 30sec        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ECS Task  â”‚        â”‚ ECS Task  â”‚        â”‚ ECS Task  â”‚
â”‚ (æ­£å¸¸)    â”‚        â”‚ (æ­£å¸¸)    â”‚        â”‚ (ç•°å¸¸)    â”‚
â”‚    âœ“      â”‚        â”‚    âœ“      â”‚        â”‚    âœ—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†‘ è»¢é€              â†‘ è»¢é€              Ã— è»¢é€ã—ãªã„
```

### 6.5 Azureæ§‹æˆã®è§£èª¬

```
Azure ãƒªã‚½ãƒ¼ã‚¹ã®å…¨ä½“åƒ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Resource Group                                â”‚
â”‚  ã€Œé–¢é€£ãƒªã‚½ãƒ¼ã‚¹ã‚’ã¾ã¨ã‚ã‚‹è«–ç†çš„ãªã‚³ãƒ³ãƒ†ãƒŠã€                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Virtual Network                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Subnet: snet-app (Container Appsç”¨)                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Container App Environment                        â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â”‚Container Appâ”‚  â”‚Container Appâ”‚              â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â”‚  (Backend)  â”‚  â”‚  (Backend)  â”‚              â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Subnet: snet-private (ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨) â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Azure OpenAI  â”‚ â”‚ Key Vault     â”‚ â”‚ Storage       â”‚          â”‚
â”‚  â”‚ Service       â”‚ â”‚ (ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ) â”‚ â”‚ Account       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.6 Azureãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬

#### 6.6.1 Azure OpenAI Service

```python
# Azure OpenAI Service - GPT-5.2ç­‰ã®LLMã‚’ãƒ›ã‚¹ãƒˆ

resource "azurerm_cognitive_account" "openai" {
    name                = "aoai-jaia-production"
    kind                = "OpenAI"
    sku_name            = "S0"

    # ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
    custom_subdomain_name = "aoai-jaia-production"
    # â†’ https://aoai-jaia-production.openai.azure.com/

    # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™
    network_acls {
        default_action = "Deny"  # æœ¬ç•ªã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ‹’å¦
        virtual_network_rules {
            subnet_id = azurerm_subnet.private.id
            # ç‰¹å®šã®ã‚µãƒ–ãƒãƒƒãƒˆã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
        }
    }
}

# ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
resource "azurerm_cognitive_deployment" "gpt5" {
    name                 = "gpt-5-2-deployment"
    cognitive_account_id = azurerm_cognitive_account.openai.id

    model {
        format  = "OpenAI"
        name    = "gpt-5.2"
        version = "2026-01"
    }

    scale {
        type     = "Standard"
        capacity = 10  # TPM (Tokens Per Minute) ã®å®¹é‡
    }
}
```

| è¨­å®šé …ç›® | èª¬æ˜ | æ¨å¥¨å€¤ |
| -------- | ---- | ------ |
| **SKU** | ä¾¡æ ¼ãƒ¬ãƒ™ãƒ« | S0ï¼ˆæ¨™æº–ï¼‰ |
| **capacity** | 1åˆ†ã‚ãŸã‚Šã®ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†èƒ½åŠ› | æœ¬ç•ªã¯10ä»¥ä¸Šæ¨å¥¨ |
| **network_acls** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | æœ¬ç•ªã§ã¯Deny + ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ |

#### 6.6.2 Container Apps

```
Container Apps vs ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure App Service                                               â”‚
â”‚ ãƒ»å¾“æ¥å‹ã®Webã‚¢ãƒ—ãƒªãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°                                 â”‚
â”‚ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠå¯¾å¿œã ãŒæŸ”è»Ÿæ€§ä½ã‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Kubernetes Service (AKS)                                  â”‚
â”‚ ãƒ»ãƒ•ãƒ«æ©Ÿèƒ½ã®Kubernetes                                         â”‚
â”‚ ãƒ»å­¦ç¿’ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€è¤‡é›‘                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Container Apps (JAIAã§æ¡ç”¨)                               â”‚
â”‚ ãƒ»ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ                          â”‚
â”‚ ãƒ»Kubernetesã®è¤‡é›‘ã•ã‚’éš è”½                                     â”‚
â”‚ ãƒ»è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°                                             â”‚
â”‚ ãƒ»HTTPSã‚¤ãƒ³ã‚°ãƒ¬ã‚¹çµ„ã¿è¾¼ã¿                                      â”‚
â”‚ ãƒ»ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆãƒ–ãƒ«ãƒ¼ã‚°ãƒªãƒ¼ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
resource "azurerm_container_app" "backend" {
    name = "ca-jaia-backend"

    template {
        container {
            name   = "backend"
            image  = "acrjaia.azurecr.io/jaia-backend:latest"
            cpu    = 1.0      # 1 vCPU
            memory = "2Gi"    # 2GB RAM

            # ç’°å¢ƒå¤‰æ•°
            env {
                name  = "LLM_PROVIDER"
                value = "azure_foundry"
            }

            # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯åˆ¥é€”å‚ç…§
            env {
                name        = "AZURE_FOUNDRY_API_KEY"
                secret_name = "azure-openai-key"
            }

            # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
            liveness_probe {
                path = "/api/v1/health"
                port = 8001
            }
        }

        # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
        min_replicas = 2   # æœ¬ç•ªã¯æœ€ä½2å°
        max_replicas = 10  # æœ€å¤§10å°ã¾ã§è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«
    }

    # HTTPSå…¬é–‹
    ingress {
        external_enabled = true
        target_port      = 8001
    }
}
```

#### 6.6.3 Key Vault

```
Key Vault - Azureã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Key Vault                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Secrets (ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ)                                   â”‚   â”‚
â”‚  â”‚ ãƒ»APIã‚­ãƒ¼                                                â”‚   â”‚
â”‚  â”‚ ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰                                             â”‚   â”‚
â”‚  â”‚ ãƒ»æ¥ç¶šæ–‡å­—åˆ—                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Keys (æš—å·åŒ–ã‚­ãƒ¼)                                        â”‚   â”‚
â”‚  â”‚ ãƒ»ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ç”¨                                         â”‚   â”‚
â”‚  â”‚ ãƒ»ç½²åç”¨                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Certificates (è¨¼æ˜æ›¸)                                    â”‚   â”‚
â”‚  â”‚ ãƒ»SSL/TLSè¨¼æ˜æ›¸                                          â”‚   â”‚
â”‚  â”‚ ãƒ»è‡ªå‹•æ›´æ–°å¯¾å¿œ                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡: Azure RBACã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼               â”‚
â”‚  ç›£æŸ»: å…¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ­ã‚°è¨˜éŒ²                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.7 GCPæ§‹æˆã®è§£èª¬

```
GCP ãƒªã‚½ãƒ¼ã‚¹ã®å…¨ä½“åƒ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GCP Project                               â”‚
â”‚  ã€Œã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã€                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    VPC Network                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Subnet: jaia-production-subnet                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ VPC Access Connector                             â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ (Cloud Runã‹ã‚‰VPCã¸ã®æ¥ç¶š)                       â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Cloud Run                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚  Instance   â”‚  â”‚  Instance   â”‚  â”‚  Instance   â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  (JAIA)     â”‚  â”‚  (JAIA)     â”‚  â”‚  (JAIA)     â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚  ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ0â†’âˆï¼‰ã€                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Vertex AI     â”‚ â”‚ Secret        â”‚ â”‚ Cloud         â”‚          â”‚
â”‚  â”‚ (Gemini 3.0)  â”‚ â”‚ Manager       â”‚ â”‚ Storage       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.8 GCPãƒªã‚½ãƒ¼ã‚¹è©³ç´°è§£èª¬

#### 6.8.1 Cloud Run

```
Cloud Run ã®ç‰¹å¾´

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ»ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹                                    â”‚
â”‚                                                                 â”‚
â”‚ å¾“æ¥ã®ã‚µãƒ¼ãƒãƒ¼:                                                 â”‚
â”‚ ãƒ»å¸¸ã«ç¨¼åƒ â†’ 24æ™‚é–“èª²é‡‘                                        â”‚
â”‚ ãƒ»æ‰‹å‹•ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°                                           â”‚
â”‚ ãƒ»OSãƒ‘ãƒƒãƒé©ç”¨ãŒå¿…è¦                                           â”‚
â”‚                                                                 â”‚
â”‚ Cloud Run:                                                      â”‚
â”‚ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿èµ·å‹• â†’ ä½¿ã£ãŸåˆ†ã ã‘èª²é‡‘                      â”‚
â”‚ ãƒ»è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆ0â†’æ•°åƒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰                       â”‚
â”‚ ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ä¸è¦                                             â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãªã„æ™‚:     ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚‹æ™‚:               â”‚    â”‚
â”‚ â”‚                                                          â”‚    â”‚
â”‚ â”‚   [ãªã—]    â†’â†’â†’â†’â†’â†’    [1] [2] [3] ... [n]             â”‚    â”‚
â”‚ â”‚                                                          â”‚    â”‚
â”‚ â”‚   èª²é‡‘: Â¥0           èª²é‡‘: ä½¿ç”¨é‡ã«å¿œã˜ã¦               â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
resource "google_cloud_run_v2_service" "backend" {
    name     = "jaia-backend"
    location = "asia-northeast1"  # æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³

    template {
        # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ¨©é™ç®¡ç†ï¼‰
        service_account = google_service_account.cloud_run.email

        # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
        scaling {
            min_instance_count = 0   # é–‹ç™º: 0ã‹ã‚‰ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
            max_instance_count = 10  # æœ€å¤§10ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
            # æœ¬ç•ªã§ã¯ min=2 æ¨å¥¨ï¼ˆã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆå›é¿ï¼‰
        }

        # VPCæ¥ç¶šï¼ˆVertex AIã¸ã®å†…éƒ¨é€šä¿¡ï¼‰
        vpc_access {
            connector = google_vpc_access_connector.main.id
            egress    = "PRIVATE_RANGES_ONLY"
            # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã¸ã®é€šä¿¡ã®ã¿VPCçµŒç”±
        }

        containers {
            image = "asia-northeast1-docker.pkg.dev/.../jaia-backend:latest"

            # ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
            resources {
                limits = {
                    cpu    = "2"     # 2 vCPU
                    memory = "2Gi"   # 2GB RAM
                }
            }

            # ç’°å¢ƒå¤‰æ•°
            env {
                name  = "LLM_PROVIDER"
                value = "vertex_ai"
            }

            # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå‚ç…§
            env {
                name = "GOOGLE_API_KEY"
                value_source {
                    secret_key_ref {
                        secret  = "jaia-production-google-api-key"
                        version = "latest"
                    }
                }
            }

            # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
            startup_probe {
                http_get {
                    path = "/api/v1/health"
                    port = 8001
                }
                initial_delay_seconds = 10
            }
        }
    }
}
```

#### 6.8.2 Vertex AI

```
Vertex AI - GCPã®AI/MLãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vertex AI                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Foundation Models (åŸºç›¤ãƒ¢ãƒ‡ãƒ«)                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚ Gemini 3.0    â”‚  â”‚ Gemini 3.0    â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚ Flash Preview â”‚  â”‚ Pro Preview   â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚ (é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆ) â”‚  â”‚ (é«˜ç²¾åº¦)      â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚ Gemini 2.5    â”‚  â”‚ Claude        â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚ Flash Lite    â”‚  â”‚ Sonnet 4.5    â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ç‰¹å¾´:                                                          â”‚
â”‚  ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ‰APIï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ä¸è¦ï¼‰                           â”‚
â”‚  ãƒ»VPC Service Controlsã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–å¯èƒ½                  â”‚
â”‚  ãƒ»ãƒªãƒ¼ã‚¸ãƒ§ãƒ³é¸æŠå¯èƒ½ï¼ˆãƒ‡ãƒ¼ã‚¿ä¸»æ¨©å¯¾å¿œï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

JAIAã§ã®Vertex AIä½¿ç”¨ä¾‹:

```python
# Python SDK ã§ã®å‘¼ã³å‡ºã—
from google.cloud import aiplatform

aiplatform.init(
    project="your-project-id",
    location="asia-northeast1"  # æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
)

# Gemini 3.0 Flash ã§ä»•è¨³åˆ†æ
model = aiplatform.GenerativeModel("gemini-3.0-flash-preview")
response = model.generate_content(
    "ã“ã®ä»•è¨³ã«ãƒªã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ\n" + journal_entry
)
```

#### 6.8.3 Cloud Armorï¼ˆWAFï¼‰

```
Cloud Armor - GCPã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ                                                  â”‚
â”‚      â”‚                                                         â”‚
â”‚      â–¼                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                    Cloud Armor                              â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚  Rule 1: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–                            â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚  â”‚ expression: evaluatePreconfiguredExpr('sqli-stable') â”‚   â”‚ â”‚
â”‚ â”‚  â”‚ action: deny(403)                                    â”‚   â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚  Rule 2: XSSå¯¾ç­–                                            â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚  â”‚ expression: evaluatePreconfiguredExpr('xss-stable')  â”‚   â”‚ â”‚
â”‚ â”‚  â”‚ action: deny(403)                                    â”‚   â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚  Rule 3: ãƒ¬ãƒ¼ãƒˆåˆ¶é™                                         â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚  â”‚ rate_limit: 100 requests / 60 seconds per IP         â”‚   â”‚ â”‚
â”‚ â”‚  â”‚ exceed_action: deny(429)                             â”‚   â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚  â†’ æ”»æ’ƒã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã‹ã‚‰Cloud Runã«è»¢é€                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚                                                         â”‚
â”‚      â–¼                                                         â”‚
â”‚    Cloud Run (å®‰å…¨ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿åˆ°é”)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.9 ã‚¯ãƒ©ã‚¦ãƒ‰æ¯”è¼ƒã¾ã¨ã‚

| è¦³ç‚¹ | AWS | Azure | GCP |
| ---- | --- | ----- | --- |
| **ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹** | ECS (Fargate) | Container Apps | Cloud Run |
| **LLMã‚µãƒ¼ãƒ“ã‚¹** | Bedrock | Azure OpenAI | Vertex AI |
| **æ¨å¥¨ãƒ¢ãƒ‡ãƒ«** | Claude Sonnet 4.6 Opus | GPT-5.2 | Gemini 3.0 |
| **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†** | Secrets Manager | Key Vault | Secret Manager |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** | S3 | Blob Storage | Cloud Storage |
| **WAF** | AWS WAF | Azure WAF | Cloud Armor |
| **ç‰¹å¾´** | æœ€ã‚‚æˆç†Ÿ | Microsoftçµ±åˆ | AI/MLå¼·ã„ |
| **æ¨å¥¨ç”¨é€”** | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º | Office365é€£æº | ã‚³ã‚¹ãƒˆé‡è¦– |

### 6.10 Terraformã‚³ãƒãƒ³ãƒ‰æ“ä½œ

```powershell
# 1. åˆæœŸåŒ–ï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
terraform init
# â†’ .terraform ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã‚‹
# â†’ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹

# 2. è¨­å®šã®æ¤œè¨¼
terraform validate
# â†’ æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯

# 3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
terraform fmt
# â†’ ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€

# 4. å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèªï¼ˆä½•ãŒä½œæˆ/å¤‰æ›´/å‰Šé™¤ã•ã‚Œã‚‹ã‹ï¼‰
terraform plan

# å‡ºåŠ›ä¾‹:
# + aws_s3_bucket.data will be created       â† æ–°è¦ä½œæˆ
# ~ aws_ecs_cluster.main will be updated     â† å¤‰æ›´
# - aws_lambda_function.old will be destroyed â† å‰Šé™¤
# Plan: 15 to add, 2 to change, 1 to destroy.

# 5. å®Ÿè¡Œï¼ˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆï¼‰
terraform apply
# â†’ "yes" ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œ

# 6. çŠ¶æ…‹ç¢ºèª
terraform show
# â†’ ç¾åœ¨ã®ãƒªã‚½ãƒ¼ã‚¹çŠ¶æ…‹ã‚’è¡¨ç¤º

# 7. å‰Šé™¤ï¼ˆå…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼‰
terraform destroy
# â†’ æœ¬ç•ªç’°å¢ƒã§ã¯çµ¶å¯¾ã«å®Ÿè¡Œã—ãªã„ã“ã¨ï¼
```

#### å„ã‚¯ãƒ©ã‚¦ãƒ‰ã§ã®å®Ÿè¡Œä¾‹

```powershell
# ===== AWS =====
cd infrastructure/terraform/aws
terraform init
terraform plan -var="environment=production"
terraform apply -var="environment=production"

# ===== Azure =====
az login  # å…ˆã«Azureã«ãƒ­ã‚°ã‚¤ãƒ³
cd infrastructure/terraform/azure
terraform init
terraform apply -var="location=japaneast"

# ===== GCP =====
gcloud auth application-default login  # å…ˆã«GCPã«ãƒ­ã‚°ã‚¤ãƒ³
cd infrastructure/terraform/gcp
terraform init
terraform apply -var="project_id=your-project-id"
```

---

## 7. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 7.1 CI/CDã¨ã¯ï¼Ÿ

```
CI (Continuous Integration) = ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
ãƒ»ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ãŸã³ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆ
ãƒ»å•é¡Œã‚’æ—©æœŸç™ºè¦‹

CD (Continuous Delivery/Deployment) = ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼/ãƒ‡ãƒ—ãƒ­ã‚¤
ãƒ»ãƒ†ã‚¹ãƒˆé€šéå¾Œã€è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤
ãƒ»äººæ‰‹ã‚’ä»‹ã•ãšæœ¬ç•ªç’°å¢ƒã¸
```

### 7.2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆ

```yaml
# .github/workflows/ci.yml

name: CI

on:
  push:
    branches: [main, develop]  # ã“ã‚Œã‚‰ã®ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚
  pull_request:
    branches: [main, develop]  # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚

env:
  PYTHON_VERSION: "3.11"
  NODE_VERSION: "20"

jobs:
  # ===========================================
  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰Lintï¼ˆã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼‰
  # ===========================================
  backend-lint:
    name: Backend Lint & Type Check
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'  # ä¾å­˜é–¢ä¿‚ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆé«˜é€ŸåŒ–ï¼‰

      - name: Install dependencies
        run: pip install -e ".[dev]"

      - name: Lint with ruff
        run: ruff check app tests  # ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯

      - name: Type check with mypy
        run: mypy app  # å‹ãƒã‚§ãƒƒã‚¯

  # ===========================================
  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
  # ===========================================
  backend-test:
    name: Backend Tests
    runs-on: ubuntu-latest
    needs: backend-lint  # LintãŒé€šã£ã¦ã‹ã‚‰å®Ÿè¡Œ

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5

      - name: Run tests with coverage
        run: pytest --cov=app --cov-report=xml

      - name: Upload coverage
        uses: codecov/codecov-action@v4  # ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

  # ===========================================
  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
  # ===========================================
  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run Bandit security scan
        run: bandit -r backend/app/ -f json -o bandit-report.json
        # Bandit: Pythonã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒŠ

      - name: Run Safety dependency check
        run: safety check --json
        # Safety: ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯

  # ===========================================
  # Dockerãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
  # ===========================================
  docker-build:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: [backend-test]

    steps:
      - uses: actions/checkout@v4
      - uses: docker/setup-buildx-action@v3

      - name: Build backend Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          push: false  # ãƒ“ãƒ«ãƒ‰ã®ã¿ã€ãƒ—ãƒƒã‚·ãƒ¥ã—ãªã„
          tags: jaia-backend:test
          cache-from: type=gha  # GitHubã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨

  # ===========================================
  # Terraformæ¤œè¨¼
  # ===========================================
  terraform-validate:
    name: Terraform Validate
    runs-on: ubuntu-latest
    strategy:
      matrix:
        cloud: [aws, azure, gcp]  # 3ã¤ã®ã‚¯ãƒ©ã‚¦ãƒ‰ä¸¦åˆ—å®Ÿè¡Œ

    steps:
      - uses: actions/checkout@v4
      - uses: hashicorp/setup-terraform@v3

      - name: Terraform Init
        run: terraform init -backend=false
        working-directory: infrastructure/terraform/${{ matrix.cloud }}

      - name: Terraform Validate
        run: terraform validate
```

### 7.3 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml
# .github/workflows/deploy.yml

name: Deploy

on:
  push:
    branches: [main]  # mainã¸ã®ãƒãƒ¼ã‚¸æ™‚
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
    inputs:
      environment:
        type: choice
        options: [development, staging, production]
      cloud_provider:
        type: choice
        options: [aws, azure, gcp]

jobs:
  deploy-aws:
    name: Deploy to AWS
    if: inputs.cloud_provider == 'aws'
    environment: ${{ inputs.environment }}  # ç’°å¢ƒä¿è­·ãƒ«ãƒ¼ãƒ«é©ç”¨

    steps:
      # 1. AWSèªè¨¼
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

      # 2. ECRã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥
      - name: Push to ECR
        run: |
          docker push $ECR_REGISTRY/jaia-backend:$IMAGE_TAG

      # 3. Terraformã§ã‚¤ãƒ³ãƒ•ãƒ©æ›´æ–°
      - name: Terraform Apply
        run: terraform apply -auto-approve

      # 4. ECSã‚µãƒ¼ãƒ“ã‚¹æ›´æ–°ï¼ˆæ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ï¼‰
      - name: Update ECS Service
        run: |
          aws ecs update-service \
            --cluster jaia-production \
            --service jaia-backend \
            --force-new-deployment
```

### 7.4 GitHub Secretsè¨­å®š

```
ãƒªãƒã‚¸ãƒˆãƒªè¨­å®š â†’ Secrets and variables â†’ Actions

å¿…è¦ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå           â”‚ èª¬æ˜                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AWS_ACCESS_KEY_ID       â”‚ AWSã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ID                    â”‚
â”‚ AWS_SECRET_ACCESS_KEY   â”‚ AWSã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼          â”‚
â”‚ AZURE_CREDENTIALS       â”‚ Azureèªè¨¼æƒ…å ±ï¼ˆJSONå½¢å¼ï¼‰            â”‚
â”‚ GCP_CREDENTIALS         â”‚ GCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON            â”‚
â”‚ GCP_PROJECT_ID          â”‚ GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¨­å®šæ‰‹é †:
1. GitHub ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. Settings â†’ Secrets and variables â†’ Actions
3. "New repository secret" ã‚’ã‚¯ãƒªãƒƒã‚¯
4. Name ã¨ Value ã‚’å…¥åŠ›ã—ã¦ä¿å­˜
```

---

## 8. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 8.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

```powershell
# =====================================
# Step 1: ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
# =====================================
git clone https://github.com/your-org/journal-ai-auditor.git
cd journal-ai-auditor

# =====================================
# Step 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# =====================================
cd backend

# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–ï¼ˆPowerShellï¼‰
.\venv\Scripts\activate

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
copy .env.example .env

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼ˆãƒ¡ãƒ¢å¸³ã§é–‹ãï¼‰
notepad .env

# =====================================
# Step 3: .envè¨­å®šä¾‹
# =====================================

# åŸºæœ¬è¨­å®š
APP_NAME=JAIA
DEBUG=true
ENVIRONMENT=development

# LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šï¼ˆã„ãšã‚Œã‹1ã¤ã‚’é¸æŠï¼‰

# --- Anthropic Claudeï¼ˆæœ€ã‚‚ç°¡å˜ï¼‰---
LLM_PROVIDER=anthropic
LLM_MODEL=claude-sonnet-4-5
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxx

# --- AWS Bedrockï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ¨å¥¨ï¼‰---
# LLM_PROVIDER=bedrock
# LLM_MODEL=us.anthropic.claude-opus-4-6-20260201-v1:0
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=AKIAxxxxxxxx
# AWS_SECRET_ACCESS_KEY=xxxxxxxx

# --- Azure Foundryï¼ˆæœ€æ–°GPT-5ï¼‰---
# LLM_PROVIDER=azure_foundry
# LLM_MODEL=gpt-5.2
# AZURE_FOUNDRY_ENDPOINT=https://your-foundry.openai.azure.com/
# AZURE_FOUNDRY_API_KEY=xxxxxxxx
# AZURE_FOUNDRY_DEPLOYMENT=gpt-5-2-deployment

# =====================================
# Step 4: ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
# =====================================
mkdir data
mkdir logs

# =====================================
# Step 5: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•
# =====================================
python -m uvicorn app.main:app --host 127.0.0.1 --port 8001 --reload

# ç¢ºèª: http://127.0.0.1:8001/docs ã«ã‚¢ã‚¯ã‚»ã‚¹

# =====================================
# Step 6: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# =====================================
# æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã
cd ../frontend
npm install
npm run dev:vite

# ç¢ºèª: http://localhost:5180 ã«ã‚¢ã‚¯ã‚»ã‚¹
```

### 8.2 ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

#### 8.2.1 AWS Bedrockã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```powershell
# =====================================
# å‰ææ¡ä»¶
# =====================================
# - AWS CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
# - AWSèªè¨¼æƒ…å ±ãŒè¨­å®šæ¸ˆã¿
# - Terraform >= 1.6.0

# =====================================
# Step 1: Bedrockãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹åŒ–
# =====================================
# AWS Console â†’ Amazon Bedrock â†’ Model access
# Claude 3.5 Sonnet, Claude Opus 4 ç­‰ã‚’æœ‰åŠ¹åŒ–

# =====================================
# Step 2: Terraformå®Ÿè¡Œ
# =====================================
cd infrastructure/terraform/aws

# å¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
@"
aws_region  = "us-east-1"
environment = "production"
app_name    = "jaia"
"@ | Out-File -FilePath terraform.tfvars -Encoding utf8

# åˆæœŸåŒ–
terraform init

# ãƒ—ãƒ©ãƒ³ç¢ºèª
terraform plan

# é©ç”¨ï¼ˆç¢ºèªå¾Œ yes ã‚’å…¥åŠ›ï¼‰
terraform apply

# =====================================
# Step 3: å‡ºåŠ›å€¤ã®ç¢ºèª
# =====================================
terraform output

# å‡ºåŠ›ä¾‹:
# ecr_repository_url = "123456789012.dkr.ecr.us-east-1.amazonaws.com/jaia-backend"
# ecs_cluster_name = "jaia-production"
# alb_dns_name = "jaia-production-alb-xxxxx.us-east-1.elb.amazonaws.com"

# =====================================
# Step 4: Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ—ãƒƒã‚·ãƒ¥
# =====================================
cd ../../../backend

# ECRãƒ­ã‚°ã‚¤ãƒ³
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 123456789012.dkr.ecr.us-east-1.amazonaws.com

# ãƒ“ãƒ«ãƒ‰
docker build -t jaia-backend .

# ã‚¿ã‚°ä»˜ã‘
docker tag jaia-backend:latest 123456789012.dkr.ecr.us-east-1.amazonaws.com/jaia-backend:latest

# ãƒ—ãƒƒã‚·ãƒ¥
docker push 123456789012.dkr.ecr.us-east-1.amazonaws.com/jaia-backend:latest
```

---

## 9. é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 9.1 ç›£è¦–é …ç›®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¡ãƒˆãƒªã‚¯ã‚¹                â”‚ é–¾å€¤      â”‚ ã‚¢ãƒ©ãƒ¼ãƒˆ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚¨ãƒ©ãƒ¼ç‡                  â”‚ > 1%      â”‚ Critical         â”‚
â”‚ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ï¼ˆP99ï¼‰     â”‚ > 5ç§’     â”‚ Warning          â”‚
â”‚ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ï¼ˆP99ï¼‰     â”‚ > 10ç§’    â”‚ Critical         â”‚
â”‚ CPUä½¿ç”¨ç‡                 â”‚ > 80%     â”‚ Warning          â”‚
â”‚ ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡              â”‚ > 85%     â”‚ Warning          â”‚
â”‚ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç™ºå‹•å›æ•°        â”‚ > 100/åˆ†  â”‚ Investigation    â”‚
â”‚ IPãƒ–ãƒ­ãƒƒã‚¯å›æ•°            â”‚ > 10/æ™‚   â”‚ Investigation    â”‚
â”‚ LLM APIã‚¨ãƒ©ãƒ¼ç‡           â”‚ > 5%      â”‚ Critical         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ãƒ­ã‚°ç›£è¦–ã‚¯ã‚¨ãƒªä¾‹

```python
# CloudWatch Logs Insights ã‚¯ã‚¨ãƒªä¾‹

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ¤œç´¢
fields @timestamp, @message
| filter level = "ERROR"
| sort @timestamp desc
| limit 100

# ç‰¹å®šãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã®è¿½è·¡
fields @timestamp, level, message, request_id
| filter request_id = "abc12345"
| sort @timestamp asc

# é…ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç‰¹å®š
fields @timestamp, path, duration_ms
| filter duration_ms > 5000
| sort duration_ms desc
| limit 50

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–
fields @timestamp, event_type, client_ip, message
| filter @logStream like /security/
| filter event_type in ["rate_limit_exceeded", "suspicious_request", "ip_temp_blocked"]
| sort @timestamp desc
```

### 9.3 éšœå®³å¯¾å¿œãƒ•ãƒ­ãƒ¼

```
éšœå®³æ¤œçŸ¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å½±éŸ¿ç¯„å›²ã®ç¢ºèª                    â”‚
â”‚    - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°                      â”‚
â”‚    - å½±éŸ¿æ©Ÿèƒ½                        â”‚
â”‚    - ã‚¨ãƒ©ãƒ¼ç‡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åŸå› ã®ç‰¹å®š                        â”‚
â”‚    - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª                  â”‚
â”‚    - ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDè¿½è·¡                â”‚
â”‚    - æœ€è¿‘ã®ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æš«å®šå¯¾å¿œ                          â”‚
â”‚    - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œè¨                â”‚
â”‚    - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶é™                â”‚
â”‚    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ’ä¹…å¯¾å¿œ                          â”‚
â”‚    - æ ¹æœ¬åŸå› ã®ä¿®æ­£                  â”‚
â”‚    - ãƒ†ã‚¹ãƒˆå®Ÿæ–½                      â”‚
â”‚    - å†ç™ºé˜²æ­¢ç­–ã®æ¤œè¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æŒ¯ã‚Šè¿”ã‚Šï¼ˆãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ï¼‰        â”‚
â”‚    - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¨˜éŒ²                â”‚
â”‚    - å­¦ã‚“ã ã“ã¨                      â”‚
â”‚    - æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```
å®šæœŸãƒã‚§ãƒƒã‚¯ï¼ˆé€±æ¬¡ï¼‰:
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®ç•°å¸¸ç¢ºèª
â–¡ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ»IPãƒ–ãƒ­ãƒƒã‚¯ã®çµ±è¨ˆç¢ºèª
â–¡ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³

å®šæœŸãƒã‚§ãƒƒã‚¯ï¼ˆæœˆæ¬¡ï¼‰:
â–¡ APIã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ¤œè¨
â–¡ IAMæ¨©é™ã®æ£šå¸ã—
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®šç¢ºèª
â–¡ SSLè¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ç¢ºèª

ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿæ™‚:
â–¡ å½±éŸ¿ã‚’å—ã‘ãŸAPIã‚­ãƒ¼ã®å³æ™‚ç„¡åŠ¹åŒ–
â–¡ æ”»æ’ƒå…ƒIPã®æ°¸ä¹…ãƒ–ãƒ­ãƒƒã‚¯è¿½åŠ 
â–¡ ç›£æŸ»ãƒ­ã‚°ã®ä¿å…¨
â–¡ é–¢ä¿‚è€…ã¸ã®å ±å‘Š
```

---

## ä»˜éŒ²A: ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é–“ã«æŒŸã¾ã‚‹å‡¦ç†å±¤ |
| **ãƒ¬ãƒ¼ãƒˆåˆ¶é™** | å˜ä½æ™‚é–“ã‚ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’åˆ¶é™ã™ã‚‹æ©Ÿèƒ½ |
| **ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦** | ç¾åœ¨ã‹ã‚‰éå»Nç§’é–“ã‚’å¯¾è±¡ã¨ã™ã‚‹è¨ˆç®—æ–¹å¼ |
| **HSTS** | HTTPSã‚’å¼·åˆ¶ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿæ§‹ |
| **CSP** | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã€ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã‚’åˆ¶é™ |
| **XSS** | ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°ã€æ‚ªæ„ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥ |
| **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³** | SQLæ–‡ã‚’ä¸æ­£ã«æ“ä½œã™ã‚‹æ”»æ’ƒ |
| **Terraform** | ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰ã§å®šç¾©ã™ã‚‹IaCãƒ„ãƒ¼ãƒ« |
| **ECS** | AWSã®ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ |
| **IAM** | AWSã®èªè¨¼ãƒ»èªå¯ã‚µãƒ¼ãƒ“ã‚¹ |
| **CI/CD** | ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³/ãƒ‡ãƒªãƒãƒªãƒ¼ |

---

## ä»˜éŒ²B: å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [FastAPIå…¬å¼](https://fastapi.tiangolo.com/)
- [Terraformå…¬å¼](https://developer.hashicorp.com/terraform)
- [GitHub Actionså…¬å¼](https://docs.github.com/ja/actions)

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWEï¼ˆå…±é€šè„†å¼±æ€§ã‚¿ã‚¤ãƒ—ï¼‰](https://cwe.mitre.org/)

### ã‚¯ãƒ©ã‚¦ãƒ‰
- [AWS Bedrock](https://docs.aws.amazon.com/bedrock/)
- [Azure OpenAI](https://learn.microsoft.com/azure/ai-services/openai/)
- [Google Vertex AI](https://cloud.google.com/vertex-ai/docs)

---

**æ”¹è¨‚å±¥æ­´**

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å†…å®¹ |
|------|-----------|------|
| 2026-02-08 | 2.0 | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½è¿½åŠ ã€è©³ç´°è§£èª¬è¿½åŠ  |
| 2026-01-15 | 1.0 | åˆç‰ˆä½œæˆ |
