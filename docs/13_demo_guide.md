# JAIA デモ手順書

本書は、JAIAの全機能をステップバイステップでデモンストレーションするための手順書です。
初めてJAIAに触れる方でも、この手順に沿って操作すればJAIAの主要機能を体験できます。

---

## 目次

1. [事前準備](#1-事前準備)
2. [サンプルデータの概要](#2-サンプルデータの概要)
3. [環境起動](#3-環境起動)
4. [デモシナリオ A: データ取込とダッシュボード](#4-デモシナリオ-a-データ取込とダッシュボード)
5. [デモシナリオ B: バッチ分析（ルール+ML）](#5-デモシナリオ-b-バッチ分析ルールml)
6. [デモシナリオ C: AI分析（エージェント）](#6-デモシナリオ-c-ai分析エージェント)
7. [デモシナリオ D: レポート生成](#7-デモシナリオ-d-レポート生成)
8. [自動デモスクリプト](#8-自動デモスクリプト)
9. [トラブルシューティング](#9-トラブルシューティング)
10. [プレゼンテーション用ポイント](#10-プレゼンテーション用ポイント)

---

## 1. 事前準備

### 1.1 必要な環境

| 項目 | 要件 | 確認方法 |
|------|------|----------|
| Python | 3.11以上 | `python --version` |
| Node.js | 20以上 | `node --version` |
| ブラウザ | Chrome / Edge 推奨 | - |
| LLMプロバイダー | いずれか1つ（AI分析デモ時） | `.env`ファイル確認 |

### 1.2 セットアップ確認

セットアップが完了していない場合は、先に [セットアップガイド](./06_setup_guide.md) を参照してください。

```powershell
# プロジェクトルートで確認
cd journal-ai-auditor

# バックエンドの仮想環境が存在するか
Test-Path backend\venv

# サンプルデータが存在するか
Test-Path sample_data\10_journal_entries.csv
```

### 1.3 LLMの準備（AI分析デモ用）

AI分析デモ（シナリオC）を実行するには、LLMプロバイダーの設定が必要です。
最も簡単な方法は **Ollama（ローカルLLM）** です。

```powershell
# Ollamaの場合（APIキー不要）
ollama serve                    # 別ターミナルで起動
ollama pull phi4                # モデルをダウンロード（約2.7GB）
```

`backend/.env` に以下を設定：

```ini
LLM_PROVIDER=ollama
LLM_MODEL=phi4
OLLAMA_BASE_URL=http://localhost:11434
```

他のプロバイダーを使う場合は [クイックスタート](./00_quickstart.md) のオプションA〜Hを参照してください。

---

## 2. サンプルデータの概要

JAIAには「グローバル塗料株式会社」というモデル企業のリアルなサンプルデータが付属しています。

### 2.1 データ規模

| データ | 件数 | ファイル |
|--------|------|----------|
| 仕訳データ | 約450,000件（784,824行） | `sample_data/10_journal_entries.csv` |
| 勘定科目マスタ | 215科目 | `sample_data/01_chart_of_accounts.csv` |
| 部門マスタ | 81部門 | `sample_data/02_department_master.csv` |
| 取引先マスタ | 63社 | `sample_data/03_vendor_master.csv` |
| ユーザーマスタ | 51名 | `sample_data/04_user_master.csv` |

### 2.2 モデル企業

| 項目 | 内容 |
|------|------|
| 企業名 | グローバル塗料株式会社（Global Paint Corporation） |
| 業種 | 塗料・化学製品製造業 |
| 決算期 | 3月期（2024年度: 2023/4〜2024/3） |
| 売上高 | 約5,888億円 |
| 総資産 | 約7,507億円 |
| セグメント | 日本/インド/欧州/アジア/アフリカ/北米 |

### 2.3 埋め込み済みパターン

デモ用に意図的に埋め込まれた不正・異常パターン：

**不正パターン（10種類・約1,100件）**

| ID | パターン名 | 件数 | リスク | デモポイント |
|----|-----------|------|--------|-------------|
| F01 | 自己承認仕訳 | 150 | HIGH | 起票者=承認者の高額仕訳 |
| F02 | 架空売上計上 | 30 | CRITICAL | 実在しない取引先への売上 |
| F03 | 循環取引 | 45 | CRITICAL | A→B→C→Aの資金還流 |
| F04 | 期末偏重売上 | 80 | MEDIUM | 3月最終週に集中する売上 |
| F05 | 関連当事者操作 | 25 | HIGH | グループ間の利益移転 |
| F06 | 仮勘定長期滞留 | 60 | MEDIUM | 1年超の仮払金・仮受金 |
| F07 | 経費分割 | 120 | MEDIUM | 承認基準回避の分割計上 |
| F08 | 休日高額仕訳 | 40 | MEDIUM | 土日祝の500万円超仕訳 |
| F09 | 摘要欠損 | 200 | LOW | 100万円超で摘要なし |
| F10 | ベンフォード違反 | 350 | LOW | 第一桁の不自然な分布 |

**異常パターン（7種類・約3,546件）**

| ID | パターン名 | 件数 | デモポイント |
|----|-----------|------|-------------|
| A01 | 丸め金額 | 500 | 端数なしの金額が多数 |
| A02 | 逆仕訳多発 | 180 | 同一取引の頻繁な取消 |
| A03 | 深夜入力 | 75 | 22時以降の仕訳入力 |
| A04 | 月末集中 | 2,500 | 月末3日間に30%超集中 |
| A05 | 売上債権逆相関 | 40 | 売上増なのに売掛金減少 |
| A06 | 特定担当者偏り | 300 | 1人で高額仕訳の50%超 |
| A09 | 為替差損益異常 | 45 | 為替レートとの乖離 |

---

## 3. 環境起動

### 3.1 バックエンドの起動

```powershell
cd backend
.\venv\Scripts\Activate.ps1
python -m uvicorn app.main:app --host 127.0.0.1 --port 8001 --reload
```

確認: ブラウザで http://localhost:8001/docs を開く → Swagger UIが表示

### 3.2 フロントエンドの起動

新しいターミナルを開いて：

```powershell
cd frontend
npm run dev:vite
```

確認: ブラウザで http://localhost:5180 を開く → JAIAダッシュボードが表示

### 3.3 サンプルデータのロード

```powershell
# プロジェクトルートで実行
python scripts/load_sample_data.py
```

成功メッセージ：
```
Loading sample data from: ...\sample_data\10_journal_entries.csv
Successfully imported 784824 rows!
```

続いてサンプル違反データを挿入：

```powershell
python scripts/insert_sample_violations.py
```

---

## 4. デモシナリオ A: データ取込とダッシュボード

**所要時間**: 約5分
**LLM不要**: このシナリオはLLM設定なしで実行可能

### Step 1: ダッシュボードを開く

1. ブラウザで http://localhost:5180 にアクセス
2. 「ダッシュボード」ページが表示される

### Step 2: KPIカードの確認

画面上部のKPIカードで以下を説明：

| KPI | 説明ポイント |
|-----|-------------|
| 総仕訳件数 | 約45万件の仕訳データ |
| リスク検出件数 | ルール+MLで検出された異常件数 |
| 高リスク仕訳率 | 全体に占める高リスク仕訳の割合 |
| 平均リスクスコア | 0-100の統合リスクスコア |

### Step 3: リスク分布チャート

- ドーナツチャート: Critical/High/Medium/Low の分布
- 時系列チャート: 月次の仕訳件数推移（3月の期末集中に注目）

### Step 4: データ取込のデモ（APIで実施）

Swagger UI（http://localhost:8001/docs）を使って：

1. `POST /api/v1/import/upload` エンドポイントを開く
2. `sample_data/10_journal_entries.csv` をアップロード
3. レスポンスでインポート件数を確認

---

## 5. デモシナリオ B: バッチ分析（ルール+ML）

**所要時間**: 約10分
**LLM不要**: このシナリオはLLM設定なしで実行可能

### Step 1: 監査ルール一覧の確認

Swagger UIで `GET /api/v1/batch/rules` を実行：

```json
// レスポンス例
{
  "rules": [
    {"rule_id": "AMT_001", "category": "金額", "description": "重要性基準値超過"},
    {"rule_id": "TIME_001", "category": "時間", "description": "営業時間外入力"},
    ...
  ]
}
```

**説明ポイント**: 6カテゴリ・58ルールで仕訳を多角的に検証

### Step 2: バッチ処理の実行

Swagger UIで `POST /api/v1/batch/execute` を実行：

```json
{
  "fiscal_year": 2024,
  "steps": ["rules", "ml", "scoring", "aggregation"]
}
```

**説明ポイント**:
- **rules**: 58の監査ルールを全仕訳に適用
- **ml**: 5種のML異常検知（Isolation Forest, LOF, One-Class SVM, Autoencoder, Benford）
- **scoring**: ルールスコア(60%) + MLスコア(40%) の統合リスクスコア算出
- **aggregation**: ダッシュボード用の集計テーブル更新

### Step 3: 違反仕訳の確認

`GET /api/v1/analysis/violations` で検出された違反を確認：

- 自己承認（F01）: 承認者と起票者が同一
- 期末集中（F04）: 3月最終週に売上が集中
- 丸め金額（A01）: 端数のない不自然な金額

### Step 4: Benford分析の確認

`GET /api/v1/dashboard/benford?fiscal_year=2024` で：

- 第一桁分布グラフ: 理論値 vs 実測値
- MAD（平均絶対偏差）: 適合性の判定（Acceptable/Marginal/Non-conformity）
- **注目**: F10パターン（ベンフォード違反350件）の影響を確認

---

## 6. デモシナリオ C: AI分析（エージェント）

**所要時間**: 約15分
**LLM必須**: Ollama または クラウドLLMプロバイダーが必要

### Step 1: AI分析ページを開く

1. フロントエンドで「AI分析」タブをクリック
2. AIチャットインターフェースが表示される

### Step 2: 自律分析の開始

チャットに以下を入力：

```
2024年度の仕訳データを分析して、リスクの高い仕訳を特定してください
```

**エージェントの動作を説明**:

| フェーズ | エージェント | 実行内容 |
|---------|------------|---------|
| 1. 計画 | Orchestrator | 分析計画を策定 |
| 2. 探索 | Explorer | ダッシュボードを走査、概要把握 |
| 3. 分析 | TrendAnalyzer + RiskAnalyzer | 時系列異常・ルール違反を深掘り |
| 4. 調査 | Investigator | 個別仕訳の詳細調査 |
| 5. 検証 | Verifier | 発見事項の妥当性検証 |
| 6. 報告 | Reporter | 結果を要約・構造化 |

### Step 3: 対話的な分析

AIが発見事項を報告した後、追加質問を投げかける：

```
自己承認仕訳の上位10件を金額順に表示してください
```

```
3月の期末売上が前年と比べてどう変化しているか分析してください
```

```
循環取引の疑いがある仕訳パターンを調べてください
```

### Step 4: Human-in-the-Loop

AIが判断を求めてくる場面をデモ：

- 「この仕訳を要確認としてマークしますか？」→ 承認
- 「追加の調査範囲を広げますか？」→ 指示

---

## 7. デモシナリオ D: レポート生成

**所要時間**: 約5分

### Step 1: レポートテンプレートの確認

`GET /api/v1/reports/templates` で利用可能なテンプレートを確認

### Step 2: PPTレポート生成

`POST /api/v1/reports/export/ppt` で監査報告書を生成：

```json
{
  "fiscal_year": 2024,
  "template": "standard_audit",
  "include_charts": true
}
```

**生成されるスライド構成（10枚）**:

| No | スライド | 内容 |
|----|---------|------|
| 1 | 表紙 | 企業名・対象期間・作成日 |
| 2 | エグゼクティブサマリー | 重要発見事項の要約 |
| 3 | 期間サマリー | 仕訳件数・金額の概要 |
| 4 | リスク概況 | リスクレベル分布 |
| 5-7 | 重要発見事項 Top3 | 詳細分析結果 |
| 8 | 財務指標ハイライト | 主要KPI |
| 9 | 提言・アクションアイテム | 改善提案 |
| 10 | Appendix | 補足データ |

### Step 3: PDFレポート生成

`POST /api/v1/reports/export/pdf` で詳細レポートを生成

---

## 8. 自動デモスクリプト

環境確認とAPIテストを一括実行するスクリプトが用意されています。

```powershell
.\scripts\demo.ps1
```

スクリプトの実行内容：

1. 環境確認（Python、仮想環境、サンプルデータ）
2. 仮想環境の有効化
3. バックエンドの起動状態確認（未起動時は起動オプションあり）
4. 8つのAPIエンドポイントの自動テスト
5. 結果サマリーの表示

---

## 9. トラブルシューティング

### バックエンドが起動しない

```powershell
# 依存関係を再インストール
cd backend
.\venv\Scripts\Activate.ps1
pip install -r requirements.txt --force-reinstall
```

### サンプルデータのロードに失敗する

```powershell
# データベースファイルを削除して再ロード
Remove-Item backend\data\jaia.duckdb -ErrorAction SilentlyContinue
python scripts/load_sample_data.py
```

### AI分析が動作しない

1. `.env` ファイルの `LLM_PROVIDER` と対応するAPIキーを確認
2. Ollamaの場合: `ollama list` でモデルがダウンロード済みか確認
3. ログを確認: `backend/logs/jaia.log`

### フロントエンドが表示されない

```powershell
cd frontend
Remove-Item -Recurse node_modules -ErrorAction SilentlyContinue
npm install
npm run dev:vite
```

---

## 10. プレゼンテーション用ポイント

### 訴求すべき主要機能

| 機能 | デモのポイント | インパクト |
|------|--------------|-----------|
| 58監査ルール | 人手では数日かかる検証を秒単位で実行 | 効率化 |
| 5種ML異常検知 | ルールでは検出困難な統計的異常を発見 | 精度向上 |
| 統合リスクスコア | ルール+MLの重み付け統合で偽陽性を低減 | 信頼性 |
| AIエージェント自律分析 | 人間の監査人のように自律的に分析 | 革新性 |
| マルチクラウドLLM対応 | 8プロバイダー対応、オンプレ(Ollama)も可 | 柔軟性 |
| AICPA準拠 | Audit Data Standards(GL_Detail)に完全対応 | 標準準拠 |

### 推奨デモ順序（30分プレゼン）

| 時間 | 内容 | シナリオ |
|------|------|----------|
| 0-3分 | JAIAの概要説明 | - |
| 3-8分 | ダッシュボード＋KPI | シナリオA |
| 8-18分 | バッチ分析＋Benford | シナリオB |
| 18-28分 | AI分析（対話デモ） | シナリオC |
| 28-30分 | レポート生成＋Q&A | シナリオD |

### 推奨デモ順序（15分ショートデモ）

| 時間 | 内容 |
|------|------|
| 0-2分 | 概要説明 |
| 2-5分 | ダッシュボードのKPIとリスク分布 |
| 5-10分 | AI分析の自律分析を1回実行 |
| 10-13分 | 発見事項を確認、追加質問 |
| 13-15分 | レポート生成＋Q&A |

---

## 関連ドキュメント

- [クイックスタート](./00_quickstart.md) - 初回セットアップ
- [セットアップガイド](./06_setup_guide.md) - 全8プロバイダーの詳細設定
- [ユーザーマニュアル](./07_user_manual.md) - 全機能の操作方法
- [サンプルデータ仕様書](../sample_data/00_sample_data_spec.md) - データの詳細仕様
- [APIリファレンス](./08_api_quick_reference.md) - APIエンドポイント一覧
