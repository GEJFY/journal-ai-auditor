# JAIA ユーザー操作マニュアル

Journal entry AI Analyzer（JAIA）の完全操作ガイドです。
すべての機能・画面・設定について、ステップバイステップで解説します。

---

## 目次

1. [はじめに](#1-はじめに)
2. [システム概要とアーキテクチャ](#2-システム概要とアーキテクチャ)
3. [初期設定](#3-初期設定)
4. [データインポート（ImportPage）](#4-データインポートimportpage)
5. [ダッシュボード（DashboardPage）](#5-ダッシュボードdashboardpage)
6. [リスク分析（RiskPage）](#6-リスク分析riskpage)
7. [AI分析（AIAnalysisPage）](#7-ai分析aianalysispage)
8. [レポート生成（ReportsPage）](#8-レポート生成reportspage)
9. [設定（SettingsPage）](#9-設定settingspage)
10. [58の監査ルール一覧](#10-58の監査ルール一覧)
11. [ML異常検知の詳細](#11-ml異常検知の詳細)
12. [ベンフォードの法則分析](#12-ベンフォードの法則分析)
13. [リスクスコアリングの仕組み](#13-リスクスコアリングの仕組み)
14. [LLMプロバイダー設定ガイド](#14-llmプロバイダー設定ガイド)
15. [トラブルシューティング](#15-トラブルシューティング)
16. [付録](#16-付録)

---

## 1. はじめに

### 1.1 JAIAとは

JAIA（Journal entry AI Analyzer）は、仕訳データの分析と内部監査を支援する
デスクトップアプリケーションです。58の監査ルール、5つのML異常検知手法、
ベンフォードの法則分析、および5種類のAIエージェントを組み合わせて、
不正や誤謬のリスクが高い仕訳を自動的に検出します。

### 1.2 対象ユーザー

- 内部監査人
- 外部監査人（会計監査）
- 経理・財務部門の管理者
- コンプライアンス担当者

### 1.3 主な機能一覧

| 機能 | 説明 |
|------|------|
| データインポート | AICPA GL_Detail形式のExcel/CSVファイルから仕訳データを取り込み |
| ダッシュボード | KPI、リスク分布、時系列分析、上位リスク仕訳の可視化 |
| リスク分析 | 58の監査ルール + 5つのML手法 + ベンフォード分析による違反検出 |
| AI分析 | 5種類のAIエージェントによる自律的な仕訳分析・調査 |
| レポート生成 | PPT（10スライド、ネイティブチャート付き）/ PDF形式での監査報告書 |
| 設定管理 | 8プロバイダー対応のLLM設定、ルール閾値のカスタマイズ |

### 1.4 画面構成

```
┌───────────────────────────────────────────────────────────────┐
│  ヘッダー（JAIAロゴ、ナビゲーション）             [設定ボタン] │
├──────────┬────────────────────────────────────────────────────┤
│          │                                                    │
│ サイドバー│              メインコンテンツエリア                │
│          │                                                    │
│ ・ダッシュ│   選択された画面の内容が表示されます               │
│   ボード │                                                    │
│ ・インポー│   - ダッシュボード: KPI・チャート                  │
│   ト     │   - インポート: ファイル選択・プレビュー            │
│ ・リスク  │   - リスク分析: 違反一覧・フィルター               │
│   分析   │   - AI分析: エージェント実行・結果表示              │
│ ・AI分析  │   - レポート: 生成設定・ダウンロード               │
│ ・レポート│   - 設定: LLM・ルール設定                          │
│ ・設定   │                                                    │
│          │                                                    │
├──────────┴────────────────────────────────────────────────────┤
│  ステータスバー（バージョン情報、接続状態）                    │
└───────────────────────────────────────────────────────────────┘
```

---

## 2. システム概要とアーキテクチャ

### 2.1 技術スタック

| コンポーネント | 技術 |
|---------------|------|
| フロントエンド | Electron + React + TypeScript |
| チャートライブラリ | Recharts |
| バックエンド | Python 3.11 + FastAPI |
| データ処理 | Polars DataFrame |
| 分析用データベース | DuckDB |
| メタデータベース | SQLite |
| ML/統計 | scikit-learn, scipy |
| AIエージェント | LangGraph + LangChain |
| レポート生成 | python-pptx, ReportLab, matplotlib |

### 2.2 データフロー

```
Excel/CSV ──→ インポート ──→ DuckDB ──→ ルールエンジン ──→ 違反検出
                                │              │
                                │              ├──→ ML異常検知
                                │              ├──→ ベンフォード分析
                                │              └──→ リスクスコアリング
                                │
                                └──→ AIエージェント ──→ 分析レポート
                                              │
                                              └──→ PPT/PDF出力
```

### 2.3 サポートするLLMプロバイダー（8種類）

JAIAは以下の8つのLLMプロバイダーに対応しています：

| # | プロバイダー | 種別 | 主要モデル |
|---|-------------|------|-----------|
| 1 | AWS Bedrock | クラウド（エンタープライズ推奨） | Claude Opus 4.6, Sonnet 4.5, Nova Premier |
| 2 | Azure AI Foundry | クラウド | GPT-5.2, GPT-5, Claude Opus 4.6 |
| 3 | GCP Vertex AI | クラウド | Gemini 3 Pro, Gemini 3 Flash Preview |
| 4 | Anthropic Direct | API直接 | Claude Opus 4.6, Sonnet 4.5, Haiku 4.5 |
| 5 | OpenAI Direct | API直接 | GPT-5.2, GPT-5, o3-pro, o4-mini |
| 6 | Google AI Studio | API直接 | Gemini 2.5 Pro, Gemini 3 Flash Preview |
| 7 | Azure OpenAI (Legacy) | クラウド | GPT-4o, GPT-4o Mini |
| 8 | Ollama (ローカル) | ローカル | Phi-4, DeepSeek R1 14B, Gemma 3 27B |

---

## 3. 初期設定

### 3.1 アプリケーションの起動

1. JAIAアプリケーションのアイコンをダブルクリック
2. バックエンドサーバーが自動的に起動（ポート8090）
3. フロントエンドが起動し、ダッシュボードが表示されます

### 3.2 初回起動時の設定

初回起動時は以下の設定を行ってください：

1. **設定画面**（サイドバー「設定」）を開く
2. **LLMプロバイダー**を選択（詳細は[第14章](#14-llmプロバイダー設定ガイド)参照）
3. **APIキー**または認証情報を入力
4. **接続テスト**ボタンで接続を確認
5. 設定を保存

### 3.3 環境変数ファイル（.env）

バックエンドの設定は `.env` ファイルで管理します：

```env
# アプリケーション設定
APP_NAME=JAIA
DEBUG=false
ENVIRONMENT=production

# サーバー設定
HOST=127.0.0.1
PORT=8090

# データベースパス
DATA_DIR=./data
DUCKDB_PATH=./data/jaia.duckdb
SQLITE_PATH=./data/jaia_meta.db

# LLMプロバイダー設定（使用するプロバイダーに応じて設定）
LLM_PROVIDER=bedrock
LLM_MODEL=us.anthropic.claude-opus-4-6-20260201-v1:0

# AWS Bedrock（エンタープライズ推奨）
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key

# Anthropic Direct API
ANTHROPIC_API_KEY=sk-ant-xxxxx

# OpenAI Direct API
OPENAI_API_KEY=sk-xxxxx
```

> **注意**: APIキーは必ず `.env` ファイルに記載し、ソースコードにハードコードしないでください。

---

## 4. データインポート（ImportPage）

### 4.1 対応データ形式

JAIAは **AICPA GL_Detail形式** に準拠したデータを取り込みます。

#### 対応ファイル形式

| 形式 | 拡張子 | 備考 |
|------|--------|------|
| Excel | .xlsx, .xls | 推奨形式。複数シート対応 |
| CSV | .csv | UTF-8エンコーディング推奨 |

#### 必須カラム（AICPA GL_Detail形式）

| カラム名 | データ型 | 説明 | 例 |
|---------|---------|------|-----|
| gl_detail_id | 文字列 | GL明細の一意識別子 | GLD-2025-000001 |
| journal_id | 文字列 | 仕訳番号 | JE-2025-0001 |
| fiscal_year | 整数 | 会計年度 | 2025 |
| accounting_period | 整数 | 会計期間（1-12） | 3 |
| effective_date | 日付 | 仕訳の発効日 | 2025-03-31 |
| entry_date | 日付/日時 | 仕訳の入力日時 | 2025-03-31 18:30:00 |
| gl_account_number | 文字列 | 勘定科目コード | 1100 |
| amount | 数値 | 金額（借方:正、貸方:負） | 1000000 |
| functional_currency_code | 文字列 | 機能通貨コード | JPY |
| je_line_description | 文字列 | 仕訳行摘要 | 売上計上 |
| source | 文字列 | 仕訳ソース | MANUAL |
| prepared_by | 文字列 | 作成者 | user001 |
| approved_by | 文字列 | 承認者 | manager001 |
| business_unit_code | 文字列 | 事業部コード | BU01 |

#### オプションカラム

| カラム名 | データ型 | 説明 |
|---------|---------|------|
| entered_currency_code | 文字列 | 入力通貨コード |
| amount_in_entered_currency | 数値 | 入力通貨での金額 |
| document_number | 文字列 | 証憑番号 |
| je_header_description | 文字列 | 仕訳ヘッダー摘要 |
| reversal_indicator | 文字列 | 取消仕訳フラグ |
| adjustment_indicator | 文字列 | 修正仕訳フラグ |

### 4.2 インポート手順

#### ステップ1: ファイル選択

1. サイドバーから「インポート」を選択
2. 「ファイルを選択」ボタンをクリック
3. ファイル選択ダイアログからExcel/CSVファイルを選択

#### ステップ2: カラムマッピング

ファイルアップロード後、カラムマッピング画面が表示されます：

- **ヘッダー**: ファイル名、行数、列数、未設定の必須項目数
- **マッピングテーブル**: 各取込先フィールドに対して、ファイル内の列をドロップダウンで選択
- **自動マッピング**: カラム名の類似性（日本語・英語対応）に基づき初期値を自動設定
- **サンプル値**: 選択した列の先頭データをプレビュー表示

**必須フィールド（5項目）:**

| フィールド | 日本語名 | 説明 |
|-----------|---------|------|
| journal_id | 伝票番号 | 仕訳伝票の識別番号 |
| effective_date | 計上日 | 仕訳の計上日付 |
| gl_account_number | 勘定科目コード | 勘定科目の番号 |
| amount | 金額 | 取引金額 |
| debit_credit_indicator | 借貸区分 | 借方/貸方の区分 |

> **ヒント**: 必須項目が全て設定されていない場合、「検証する」ボタンが無効になります。

#### ステップ3: バリデーション

1. カラムマッピングを確認後、「検証する」をクリック
2. バリデーション結果が表示されます：
   - **検証OK**: そのままインポート実行可能
   - **警告あり**: 確認の上「警告を無視してインポート」可能
   - **エラーあり**: エラー内容を確認し「マッピングに戻る」で修正

#### ステップ4: インポート実行

1. 「インポート実行」ボタンをクリック
2. 完了メッセージで取込件数を確認

#### インポート結果の確認

| 項目 | 説明 |
|------|------|
| インポート件数 | 正常に取り込まれた仕訳行数 |
| スキップ件数 | バリデーションエラーでスキップされた行数 |
| 重複件数 | gl_detail_idが重複してスキップされた行数 |
| 処理時間 | インポートにかかった時間 |

### 4.3 データ品質チェック

インポート時に以下の品質チェックが自動実行されます：

1. **必須カラム存在チェック**: gl_detail_id, journal_id, amount等
2. **データ型チェック**: 数値カラムに文字列がないか等
3. **日付形式チェック**: effective_date, entry_dateの妥当性
4. **金額整合性チェック**: 借貸の対応関係
5. **重複チェック**: gl_detail_idの一意性

### 4.4 よくあるインポートエラーと対処法

| エラー | 原因 | 対処法 |
|--------|------|--------|
| 必須カラム不足 | 必要なカラムが見つからない | カラム名のマッピングを確認 |
| 日付形式エラー | 不正な日付フォーマット | YYYY-MM-DD形式に統一 |
| 文字コードエラー | CSVのエンコーディングが不正 | UTF-8で保存し直す |
| 金額型エラー | 金額にカンマや通貨記号が含まれる | 数値のみのデータに整形 |
| ファイルサイズ超過 | ファイルが大きすぎる | 期間ごとに分割してインポート |

---

## 5. ダッシュボード（DashboardPage）

### 5.1 概要

ダッシュボードは、インポートされたデータの全体像を一目で把握するための画面です。
4つのKPIカード、リスク分布チャート、時系列チャート、上位リスク仕訳テーブルで構成されます。

### 5.2 KPIカード

画面上部に4つのKPIカードが表示されます：

| KPI | 説明 | 表示例 |
|-----|------|--------|
| 総仕訳件数 | インポート済みの全仕訳行数 | 125,430件 |
| フラグ付き件数 | リスクスコアが0超の仕訳数 | 3,245件 (2.6%) |
| 高リスク件数 | リスクスコア60以上の仕訳数 | 156件 |
| 平均リスクスコア | フラグ付き仕訳の平均スコア | 34.2 |

### 5.3 リスク分布チャート

**ドーナツチャート**でリスクカテゴリ別の仕訳分布を表示します：

| カテゴリ | スコア範囲 | 色 | 意味 |
|---------|----------|-----|------|
| Critical（重大） | 80-100 | 赤 | 即時調査が必要 |
| High（高） | 60-79 | オレンジ | 優先的にレビュー |
| Medium（中） | 40-59 | 黄 | 標準レビュー対象 |
| Low（低） | 20-39 | 青 | 軽微な懸念 |
| Minimal（最小） | 0-19 | グレー | 正常範囲 |

### 5.4 時系列チャート

折れ線チャートで以下の時系列データを表示します：

- **月別仕訳件数**: 各月の仕訳入力件数の推移
- **月別リスクスコア平均**: リスクスコアの月別推移
- **月別違反件数**: ルール違反の検出件数推移

期末月（3月、12月等）に仕訳が集中していないか、トレンドの異常がないかを
視覚的に確認できます。

### 5.5 上位リスク仕訳テーブル

リスクスコアの高い仕訳を一覧表示します：

| 表示項目 | 説明 |
|---------|------|
| GL Detail ID | 仕訳明細ID |
| Journal ID | 仕訳番号 |
| 日付 | 発効日 |
| 勘定科目 | GL勘定科目コード |
| 金額 | 仕訳金額 |
| リスクスコア | 0-100のスコア |
| 違反フラグ | 検出された違反ルール |
| 作成者 | 仕訳の作成者 |

テーブルはリスクスコアの降順でソートされ、上位100件が表示されます。
行をクリックすると、仕訳の詳細情報と検出された違反の一覧が表示されます。

### 5.6 フィルター機能

ダッシュボード上部のフィルターで表示データを絞り込めます：

- **会計年度**: 対象年度の選択
- **会計期間**: 対象月の選択
- **事業部コード**: 事業部での絞り込み
- **リスクカテゴリ**: 特定のリスクレベルのみ表示

---

## 6. リスク分析（RiskPage）

### 6.1 概要

リスク分析画面は、58の監査ルール、5つのML異常検知手法、およびベンフォードの法則に
基づいて検出された違反を詳細に分析する画面です。

### 6.2 分析の実行

#### ステップ1: 分析パラメータの設定

1. サイドバーから「リスク分析」を選択
2. 以下のパラメータを設定：
   - **対象年度**: 分析対象の会計年度
   - **対象期間**: 分析対象の月（全期間も選択可）
   - **ルールカテゴリ**: 実行するルールカテゴリの選択
   - **並列実行**: ルールの並列実行（推奨：ON）

#### ステップ2: 分析の実行

1. 「分析実行」ボタンをクリック
2. ルールエンジンが以下の順序で実行：
   - 金額ルール（AMT-001〜AMT-015）
   - 時間ルール（TIM-001〜TIM-010）
   - 勘定ルール（ACC-001〜ACC-020）
   - 承認ルール（APR-001〜APR-008）
   - ML異常検知（ML-001〜ML-005）
   - ベンフォード分析（BEN-001〜BEN-005）
3. プログレスバーで進捗を確認

#### ステップ3: 結果の確認

分析完了後、以下の情報が表示されます：

- **実行サマリー**: 実行ルール数、検出違反数、実行時間
- **カテゴリ別違反数**: 棒グラフで各カテゴリの違反件数を表示
- **深刻度別違反数**: ドーナツチャートで深刻度の分布を表示

### 6.3 違反一覧

検出された違反は以下のテーブルで表示されます：

| カラム | 説明 |
|--------|------|
| ルールID | AMT-001, TIM-003等のルール識別子 |
| ルール名 | 人が読める名称（例：高額取引検出） |
| カテゴリ | amount, time, account, approval, ml, pattern |
| 深刻度 | critical, high, medium, low, info |
| GL Detail ID | 違反が検出された仕訳のID |
| メッセージ | 違反の詳細説明 |
| スコア影響 | リスクスコアへの加算ポイント |

### 6.4 フィルターとソート

違反一覧は以下の条件でフィルタリング・ソートできます：

- **深刻度フィルター**: Critical / High / Medium / Low / Info
- **カテゴリフィルター**: 金額 / 時間 / 勘定 / 承認 / ML / パターン
- **ルールIDフィルター**: 特定のルールのみ表示
- **ソート**: 深刻度順、スコア影響順、日付順

### 6.5 違反の詳細表示

違反行をクリックすると、詳細パネルが展開されます：

```
┌──────────────────────────────────────────────────────┐
│ ルール: AMT-003 承認閾値直下取引                      │
│ 深刻度: HIGH                                         │
│ スコア影響: 15.0                                     │
│                                                      │
│ 対象仕訳:                                            │
│   GL Detail ID: GLD-2025-012345                      │
│   Journal ID: JE-2025-0456                           │
│   日付: 2025-03-30                                   │
│   金額: ¥9,950,000                                   │
│   勘定科目: 6100（経費）                              │
│   作成者: user023                                    │
│                                                      │
│ 検出理由:                                            │
│   金額が承認閾値（¥10,000,000）の99.5%に相当。       │
│   意図的な閾値回避の可能性があります。                 │
│                                                      │
│ 詳細:                                                │
│   - 閾値: ¥10,000,000                                │
│   - 金額: ¥9,950,000                                 │
│   - 比率: 99.5%                                      │
│   - 過去の同様取引: 3件                               │
└──────────────────────────────────────────────────────┘
```

---

## 7. AI分析（AIAnalysisPage）

### 7.1 概要

AI分析画面では、LLM（大規模言語モデル）を活用した5種類のAIエージェントにより、
仕訳データの高度な分析を行います。エージェントはLangGraphフレームワーク上で
ステートフルに動作し、オーケストレーターが全体を統括します。

### 7.2 5種類のAIエージェント

| エージェント | 種別（AgentType） | 役割 |
|------------|-------------------|------|
| 分析エージェント | ANALYSIS | ルール違反・ML結果を総合的に分析し、リスクの全体像を把握 |
| 調査エージェント | INVESTIGATION | 高リスク仕訳の詳細調査、関連取引の追跡、パターン分析 |
| 文書化エージェント | DOCUMENTATION | 監査調書・発見事項の文書化、証拠の整理 |
| QAエージェント | QA | 分析結果の品質保証、漏れの確認、論理的整合性の検証 |
| レビューエージェント | REVIEW | 最終レビュー、推奨事項の作成、経営層向けサマリーの生成 |

### 7.3 AI分析の実行手順

#### ステップ1: 分析対象の選択

1. サイドバーから「AI分析」を選択
2. 分析対象を設定：
   - **対象年度**: 分析する会計年度
   - **対象期間**: 分析する月（任意）
   - **フォーカスエリア**: 注目する分析領域
     - 全体分析（デフォルト）
     - 高リスク仕訳の深掘り
     - 特定勘定科目の分析
     - 承認プロセスの分析
     - 期末仕訳の分析

#### ステップ2: エージェントの選択

実行するエージェントを選択します（複数選択可）：

- [ ] 分析エージェント（推奨：常にON）
- [ ] 調査エージェント（高リスク仕訳がある場合に推奨）
- [ ] 文書化エージェント（報告書作成時に推奨）
- [ ] QAエージェント（品質保証が必要な場合）
- [ ] レビューエージェント（最終レポート時に推奨）

> **推奨**: 初回分析では「分析エージェント」のみ実行し、結果を確認してから
> 必要に応じて他のエージェントを追加実行してください。

#### ステップ3: 実行とモニタリング

1. 「AI分析開始」ボタンをクリック
2. エージェントの実行状況がリアルタイムで表示：
   - 現在実行中のエージェント
   - 処理中のタスク
   - 中間結果のプレビュー
3. 各エージェントの完了時に結果が順次表示

#### ステップ4: 結果の確認

AI分析の結果は以下のセクションで表示されます：

**分析サマリー**
- リスクの全体評価（高/中/低）
- 主要な発見事項のリスト
- 推奨される追加調査事項

**詳細分析結果**
- 各エージェントの分析結果（タブ切り替え）
- 検出された異常パターン
- 関連取引のグラフ表示

**推奨アクション**
- 優先度付きのアクションリスト
- 各アクションの根拠となる発見事項
- 想定されるリスクインパクト

### 7.4 オーケストレーター

オーケストレーター（ORCHESTRATOR）は、複数のエージェントを協調動作させる
統括エージェントです。以下の役割を担います：

1. **タスク分配**: 分析リクエストを適切なエージェントに振り分け
2. **状態管理**: LangGraphの状態グラフを管理し、エージェント間の情報共有を制御
3. **結果統合**: 各エージェントの結果を統合し、一貫した分析レポートを生成
4. **品質保証**: QAエージェントによるクロスチェックの実施

### 7.5 AI分析のベストプラクティス

1. **段階的な分析**: 全エージェントを一度に実行するのではなく、段階的に実行
2. **高リスクにフォーカス**: まず高リスク仕訳に絞って分析し、必要に応じて範囲を拡大
3. **コンテキストの提供**: フォーカスエリアを適切に設定し、AIに方向性を指示
4. **結果の検証**: AI分析結果は必ず監査人が確認し、専門的判断を加える
5. **LLMモデルの選択**: 複雑な分析にはClaude Opus 4.6やGPT-5.2等の高精度モデルを推奨

### 7.6 コスト管理のヒント

| 用途 | 推奨モデル | コスト目安 |
|------|-----------|-----------|
| 初期スクリーニング | Gemini 3 Flash / GPT-5 Nano | 低コスト |
| 標準分析 | Claude Sonnet 4.5 / Gemini 3 Pro | 中コスト |
| 深い調査・複雑な分析 | Claude Opus 4.6 / GPT-5.2 | 高コスト |
| ローカル開発・テスト | Phi-4 / Gemma 3 27B（Ollama） | 無料 |

---

## 8. レポート生成（ReportsPage）

### 8.1 概要

レポート生成画面では、分析結果を監査報告書として出力します。
PowerPoint（PPT）形式とPDF形式に対応しています。

### 8.2 PPTレポート（10スライド構成）

python-pptxライブラリを使用し、**ネイティブな編集可能チャート**を含む
プロフェッショナルなプレゼンテーションを生成します。

#### スライド構成

| スライド# | タイトル | 内容 |
|-----------|---------|------|
| 1 | 表紙 | レポートタイトル、会社名、対象期間、作成日 |
| 2 | エグゼクティブサマリー | 主要発見事項の要約、リスク評価の概要 |
| 3 | 主要指標 | KPIメトリクス（総件数、フラグ件数、高リスク件数、平均スコア） |
| 4 | リスク分布チャート | ドーナツチャート - リスクカテゴリ別の仕訳分布 |
| 5 | 発見事項チャート | 棒チャート - ルールカテゴリ別の違反件数 |
| 6 | ベンフォード分析チャート | カラムチャート - 理論値と実測値の比較 |
| 7 | トレンドチャート | 折れ線チャート - 月別リスクスコアの推移 |
| 8 | 推奨事項 | 発見事項に基づく推奨アクション |
| 9 | 次のステップ | フォローアップ項目と対応スケジュール |
| 10 | 付録 | 分析条件、使用ルール一覧、用語集 |

#### PPTチャートの特徴

- **ネイティブPPTXチャート**: PowerPointで直接編集可能
- **チャート種類**: ドーナツ、棒グラフ、カラムチャート、折れ線チャート
- **カラースキーム**: プロフェッショナルなネイビー系デザイン
- **日本語フォント**: メイリオ、游ゴシック対応

### 8.3 PDFレポート

ReportLabとmatplotlibを使用したPDFレポートを生成します。

#### PDF構成

| セクション | 内容 |
|-----------|------|
| 表紙 | タイトル、会社名、対象期間 |
| エグゼクティブサマリー | 主要メトリクスと発見事項 |
| リスク分析結果 | matplotlibチャート画像（リスク分布、ベンフォード、トレンド） |
| 違反詳細 | 検出された違反のテーブル形式一覧 |
| 推奨事項 | アクション項目と優先度 |

#### PDFの特徴

- **A4サイズ**: 標準的な印刷用レイアウト
- **チャート画像**: matplotlibで生成された高解像度チャート
- **日本語対応**: メイリオ / 游ゴシック / IPAGothicフォント
- **テーブル形式**: 構造化されたデータ表示

### 8.4 レポート生成手順

#### ステップ1: レポート設定

1. サイドバーから「レポート」を選択
2. 以下の設定を行います：
   - **会社名**: レポートに表示する会社名
   - **対象年度**: レポート対象の会計年度
   - **対象期間**: 開始月と終了月（任意）
   - **レポートタイトル**: カスタムタイトル（デフォルト：「仕訳検証レポート」）
   - **作成者名**: レポートの作成者名（デフォルト：JAIA）

#### ステップ2: 出力形式の選択

- **PPT**: PowerPoint形式（プレゼンテーション用、チャート編集可能）
- **PDF**: PDF形式（印刷・配布用、固定レイアウト）
- **両方**: PPTとPDFの両方を生成

#### ステップ3: 生成と保存

1. 「レポート生成」ボタンをクリック
2. 生成完了後、ダウンロードリンクが表示
3. ファイルを任意の場所に保存

### 8.5 レポート目的の選択

レポート生成時に、利用目的を選択できます：

| 目的 | 説明 | 特徴 |
|------|------|------|
| 監査人向け（auditor） | 内部・外部監査人用 | 詳細な違反データ、技術的指標を重視 |
| 経営層向け（management） | 経営報告・ガバナンス | サマリー重視、視覚的なチャート中心 |

PPT/PDFエクスポート時に目的パラメータが反映され、内容の粒度が調整されます。

### 8.6 レポートのカスタマイズ

- **詳細レベル**: 「詳細を含む」チェックボックスで違反の詳細表示を切り替え
- **期間フィルター**: 特定の月のみをレポート対象に指定可能
- **チャートの編集**: PPT形式ならPowerPointでチャートを直接編集可能

---

## 8.7 詳細分析（AnalyticsPage）

### 概要

詳細分析画面では、部門・取引先・勘定科目フローの3つの観点からデータを分析します。サイドバーの「詳細分析」からアクセスできます。

### 部門分析タブ

部門ごとの仕訳件数、借方/貸方合計、平均リスクスコア、高リスク件数、自己承認率を一覧表示します。

| 指標 | 説明 |
|------|------|
| 仕訳件数 | 当該部門の仕訳取引数 |
| 借方合計 / 貸方合計 | 金額の合計値 |
| 平均リスク | 仕訳のリスクスコア平均（0-100） |
| 高リスク件数 | リスクスコア60以上の仕訳数 |
| 自己承認率 | 起票者と承認者が同一のケースの割合 |

### 取引先分析タブ

取引先ごとの集中度分析を行います。取引金額・平均金額・最大金額・リスクスコアに加え、集中度（全取引に占める割合）をバーチャートで可視化します。

### 勘定科目フロータブ

借方勘定と貸方勘定のペアごとの資金フローを表示します。取引件数、フロー金額、平均金額を確認でき、金額比率をバーで可視化します。

---

## 9. 設定（SettingsPage）

### 9.1 概要

設定画面では、LLMプロバイダーの選択と認証情報の管理、ルールの有効/無効切り替え、
閾値のカスタマイズ等を行います。

### 9.2 LLM設定

#### プロバイダーの選択

ドロップダウンメニューから使用するLLMプロバイダーを選択します。
選択すると、そのプロバイダーで利用可能なモデル一覧が表示されます。

#### 認証情報の入力

プロバイダーごとに必要な認証情報：

| プロバイダー | 必要な設定 |
|-------------|-----------|
| AWS Bedrock | リージョン, アクセスキーID, シークレットアクセスキー |
| Azure AI Foundry | エンドポイントURL, APIキー, デプロイメント名 |
| GCP Vertex AI | プロジェクトID, リージョン, サービスアカウント認証 |
| Anthropic Direct | APIキー |
| OpenAI Direct | APIキー |
| Google AI Studio | APIキー |
| Azure OpenAI | エンドポイントURL, APIキー, デプロイメント名, APIバージョン |
| Ollama | ベースURL（デフォルト: http://localhost:11434） |

#### 接続テスト

「接続テスト」ボタンをクリックすると、選択したプロバイダーとモデルへの
接続を確認します。成功/失敗のメッセージが表示されます。

### 9.3 ルール設定

各監査ルールの有効/無効を個別に切り替えできます。
また、一部のルールでは閾値をカスタマイズできます。

#### カスタマイズ可能な閾値の例

| ルール | パラメータ | デフォルト値 | 説明 |
|--------|----------|-------------|------|
| AMT-001 | material_threshold | 10,000,000 | 高額取引の閾値 |
| AMT-003 | approval_threshold | 10,000,000 | 承認閾値 |
| AMT-003 | proximity_ratio | 0.95 | 閾値への近接比率 |
| AMT-009 | split_threshold | 10,000,000 | 分割取引検出の閾値 |
| TIM-003 | period_end_days | 5 | 期末日からの範囲（日数） |
| TIM-003 | concentration_threshold | 0.3 | 期末集中の閾値（比率） |
| ML-001 | contamination | 0.05 | Isolation Forestの異常率 |
| ML-005 | min_votes | 2 | アンサンブルの最小投票数 |

### 9.4 表示設定

- **言語**: 日本語 / English
- **テーマ**: ライト / ダーク
- **表示件数**: テーブルの1ページあたりの表示件数

---

## 10. 58の監査ルール一覧

### 10.1 金額ルール（AMT: 15ルール）

| ルールID | ルール名 | 深刻度 | 説明 |
|---------|---------|--------|------|
| AMT-001 | 高額取引検出 | HIGH | 重要性基準値を超える金額の仕訳を検出 |
| AMT-002 | 端数なし金額 | MEDIUM | 端数のない丸い金額（例: 1,000,000）を検出。推定や架空取引の兆候 |
| AMT-003 | 承認閾値直下取引 | HIGH | 承認が必要な閾値の直下（95%以上）の金額を検出。意図的な閾値回避の兆候 |
| AMT-004 | 不審金額パターン | MEDIUM | ゾロ目（111,111等）、連番（123,456等）の不審なパターンを検出 |
| AMT-005 | 金額分布異常 | MEDIUM | 勘定科目ごとの金額分布の正常範囲からの逸脱を検出 |
| AMT-006 | 統計的外れ値 | HIGH | IQR法（四分位範囲法）に基づく統計的外れ値を検出 |
| AMT-007 | 大額修正仕訳 | HIGH | 高額な修正仕訳（adjustment_indicator付き）を検出 |
| AMT-008 | 大額取消仕訳 | HIGH | 高額な取消仕訳（reversal_indicator付き）を検出 |
| AMT-009 | 分割取引検出 | HIGH | 同一作成者・同一勘定・近接日付の分割取引を検出 |
| AMT-010 | 借貸不一致 | CRITICAL | 仕訳の借方合計と貸方合計が一致しない場合を検出 |
| AMT-011 | 外貨金額異常 | MEDIUM | 入力通貨と機能通貨間の換算レート異常を検出 |
| AMT-012 | 消費税計算異常 | MEDIUM | 消費税率（10%/8%）に基づく計算結果との不整合を検出 |
| AMT-013 | 経費比率異常 | MEDIUM | 部門別経費比率が正常範囲から逸脱している場合を検出 |
| AMT-014 | 収益認識異常 | HIGH | 売上の異常な変動や期末集中を検出 |
| AMT-015 | 異常償却・引当 | MEDIUM | 減価償却費や引当金繰入額の異常な変動を検出 |

### 10.2 時間ルール（TIM: 10ルール）

| ルールID | ルール名 | 深刻度 | 説明 |
|---------|---------|--------|------|
| TIM-001 | 休日入力 | LOW | 土日祝日に入力された仕訳を検出 |
| TIM-002 | 深夜入力 | MEDIUM | 深夜時間帯（22:00-06:00）に入力された仕訳を検出 |
| TIM-003 | 期末集中 | HIGH | 期末日の直前（デフォルト5日以内）に集中する仕訳を検出 |
| TIM-004 | 遡及入力 | MEDIUM | 発効日よりも大幅に遅れて入力された仕訳を検出 |
| TIM-005 | 将来日付 | HIGH | 入力日よりも将来の発効日を持つ仕訳を検出 |
| TIM-006 | 日付乖離 | MEDIUM | 発効日と入力日の間に大きな乖離がある仕訳を検出 |
| TIM-007 | 異常入力パターン | MEDIUM | 特定ユーザーの入力タイミングの異常パターンを検出 |
| TIM-008 | 期末境界 | HIGH | 会計期間の境界をまたぐ日付設定を検出（カットオフテスト） |
| TIM-009 | 承認タイミング異常 | MEDIUM | 入力から承認までの時間が異常に短い/長い場合を検出 |
| TIM-010 | 四半期パターン異常 | MEDIUM | 四半期末ごとに繰り返される異常パターンを検出 |

### 10.3 勘定ルール（ACC: 20ルール）

| ルールID | ルール名 | 深刻度 | 説明 |
|---------|---------|--------|------|
| ACC-001 | 異常な勘定組み合わせ | HIGH | 通常は発生しない借方/貸方の勘定組み合わせを検出 |
| ACC-002 | 関連当事者取引 | HIGH | 関連当事者勘定を含む取引を検出 |
| ACC-003 | 仮勘定滞留 | MEDIUM | 仮勘定（仮払金、仮受金等）の長期滞留を検出 |
| ACC-004 | 連結会社間不一致 | HIGH | 連結会社間取引の借方/貸方の不一致を検出 |
| ACC-005 | 売上・売掛金不一致 | MEDIUM | 売上高と売掛金の変動の不整合を検出 |
| ACC-006 | 経費・買掛金不一致 | MEDIUM | 経費と買掛金の変動の不整合を検出 |
| ACC-007 | 現金異常 | HIGH | 現金勘定の異常な変動や高額取引を検出 |
| ACC-008 | 棚卸資産調整 | MEDIUM | 棚卸資産の異常な調整仕訳を検出 |
| ACC-009 | 固定資産異常 | MEDIUM | 固定資産の異常な取得・除却を検出 |
| ACC-010 | 前払費用滞留 | MEDIUM | 前払費用の長期滞留を検出 |
| ACC-011 | 未払費用戻し | MEDIUM | 未払費用の異常な戻し入れを検出 |
| ACC-012 | 税金勘定整合性 | MEDIUM | 税金関連勘定の整合性を検証 |
| ACC-013 | 評価勘定異常 | MEDIUM | 貸倒引当金等の評価勘定の異常な変動を検出 |
| ACC-014 | 資本取引 | HIGH | 資本金・資本剰余金の異常な変動を検出 |
| ACC-015 | 借入金変動 | MEDIUM | 借入金の異常な増減を検出 |
| ACC-016 | 投資勘定変動 | MEDIUM | 投資勘定の異常な変動を検出 |
| ACC-017 | 引当金変動 | MEDIUM | 各種引当金の異常な増減を検出 |
| ACC-018 | 評価替仕訳 | MEDIUM | 資産の評価替えに関する仕訳を検出 |
| ACC-019 | 勘定科目違反 | LOW | 勘定科目体系に反する使用方法を検出 |
| ACC-020 | 休眠勘定活動 | HIGH | 長期間使用されていない勘定の突然の活動を検出 |

### 10.4 承認ルール（APR: 8ルール）

| ルールID | ルール名 | 深刻度 | 説明 |
|---------|---------|--------|------|
| APR-001 | 自己承認 | **CRITICAL** | 作成者と承認者が同一人物の仕訳を検出。職務分離違反 |
| APR-002 | 未承認 | HIGH | 承認者が空欄の仕訳を検出。承認プロセスの欠如 |
| APR-003 | 承認階層違反 | MEDIUM | 承認者の権限レベルが不適切な仕訳を検出 |
| APR-004 | 一括承認 | MEDIUM | 短時間に大量の仕訳を承認しているケースを検出 |
| APR-005 | ユーザー集中 | MEDIUM | 特定ユーザーに仕訳入力が集中しているケースを検出 |
| APR-006 | 承認権限超過 | HIGH | 承認者の承認権限金額を超える仕訳の承認を検出 |
| APR-007 | 承認フロー迂回 | HIGH | 通常の承認フローを迂回した仕訳を検出 |
| APR-008 | 未認可承認者 | **CRITICAL** | 承認権限を持たないユーザーによる承認を検出 |

> **CRITICAL（重大）ルール**: APR-001（自己承認）とAPR-008（未認可承認者）は
> 不正の強い兆候であり、スコア影響が25ポイントと最も高くなります。
> 検出された場合は即座に調査を開始してください。

---

## 11. ML異常検知の詳細

### 11.1 概要

JAIAは5つの機械学習手法を用いて、ルールベースでは検出困難な異常パターンを検出します。
各手法は独立して動作し、最終的にアンサンブル投票で統合されます。

### 11.2 使用される特徴量

ML異常検知では以下の特徴量が使用されます：

| 特徴量 | 説明 |
|--------|------|
| amount | 仕訳金額（対数変換済み） |
| amount_abs | 金額の絶対値 |
| hour_of_day | 入力時刻（0-23） |
| day_of_week | 入力曜日（0-6） |
| is_weekend | 週末フラグ |
| is_period_end | 期末フラグ |
| account_frequency | 勘定科目の使用頻度 |
| user_entry_count | ユーザーの入力件数 |

### 11.3 5つのML手法

#### ML-001: Isolation Forest異常検知

- **アルゴリズム**: ランダムフォレストの変種。データポイントを「隔離」するのに
  必要な分割回数が少ないほど異常と判定
- **深刻度**: HIGH
- **パラメータ**:
  - `contamination`: 想定異常率（デフォルト: 0.05 = 5%）
  - `n_estimators`: 決定木の数（デフォルト: 100）
  - `random_state`: 再現性のための乱数シード（デフォルト: 42）
- **特徴**: 高次元データに強く、外れ値検出に優れる

#### ML-002: LOF（Local Outlier Factor）異常検知

- **アルゴリズム**: 各データポイントの局所密度を近傍と比較し、
  周囲と比べて密度が低いポイントを異常と判定
- **深刻度**: HIGH
- **パラメータ**:
  - `n_neighbors`: 近傍数（デフォルト: 20）
  - `contamination`: 想定異常率（デフォルト: 0.05）
- **特徴**: 局所的な異常に強い。クラスタ構造を考慮

#### ML-003: One-Class SVM異常検知

- **アルゴリズム**: 正常データの境界を学習し、境界外のデータを異常と判定
- **深刻度**: HIGH
- **パラメータ**:
  - `kernel`: カーネル関数（デフォルト: "rbf"）
  - `nu`: 異常率の上限（デフォルト: 0.05）
  - `gamma`: カーネル係数（デフォルト: "scale"）
- **特徴**: 非線形な決定境界を学習可能

#### ML-004: 再構成エラー異常検知（PCA）

- **アルゴリズム**: PCA（主成分分析）でデータを低次元に圧縮し、
  再構成したときの誤差が大きいデータを異常と判定
- **深刻度**: MEDIUM
- **パラメータ**:
  - `n_components`: 主成分数（デフォルト: 0.95 = 分散の95%を保持）
  - `threshold_percentile`: 異常判定の百分位数（デフォルト: 95）
- **特徴**: 次元削減ベース。データの主要な構造を捉える

#### ML-005: アンサンブル異常検知

- **アルゴリズム**: ML-001〜ML-004の結果を統合し、複数手法で異常と判定された
  データポイントのみをフラグ付け（投票方式）
- **深刻度**: CRITICAL
- **パラメータ**:
  - `min_votes`: 最小投票数（デフォルト: 2 = 4手法中2つ以上で異常と判定）
- **特徴**: 偽陽性を大幅に削減。複数手法の合意による高精度検出

### 11.4 ML結果の解釈

| 検出手法数 | 解釈 | 推奨アクション |
|-----------|------|---------------|
| 1手法のみ | 低確信度の異常 | 他のルール違反と併せて判断 |
| 2手法 | 中確信度の異常 | ルール違反の有無を確認し、必要に応じて調査 |
| 3手法以上 | 高確信度の異常 | 優先的に調査を実施 |
| 全4手法 | 最高確信度の異常 | 即時調査を推奨 |

---

## 12. ベンフォードの法則分析

### 12.1 ベンフォードの法則とは

ベンフォードの法則（Benford's Law）は、自然発生的な数値データにおいて、
先頭桁の出現頻度が一様ではなく、小さい数字ほど頻繁に現れるという法則です。
仕訳データにおいて、この法則からの逸脱は不正や操作の兆候となります。

### 12.2 理論的な出現頻度

| 先頭桁 | 理論値 | 意味 |
|--------|-------|------|
| 1 | 30.1% | 最も出現頻度が高い |
| 2 | 17.6% | |
| 3 | 12.5% | |
| 4 | 9.7% | |
| 5 | 7.9% | |
| 6 | 6.7% | |
| 7 | 5.8% | |
| 8 | 5.1% | |
| 9 | 4.6% | 最も出現頻度が低い |

### 12.3 5つのベンフォード分析ルール

| ルールID | 分析種別 | 説明 |
|---------|---------|------|
| BEN-001 | 第1桁分析 | 先頭桁の分布をカイ二乗検定で検証 |
| BEN-002 | 第2桁分析 | 2桁目の分布を検証 |
| BEN-003 | 先頭2桁分析 | 先頭2桁（10-99）の分布を検証 |
| BEN-004 | 合計分析 | 桁ごとの合計金額の偏りを検証 |
| BEN-005 | 個別取引フラグ | ベンフォード逸脱に該当する個別取引をフラグ付け |

### 12.4 適合度の判定基準（MAD）

MAD（Mean Absolute Deviation：平均絶対偏差）により適合度を判定します。
基準はNigrini（2012）に準拠しています。

#### 第1桁の基準

| MAD値 | 判定 | 意味 |
|-------|------|------|
| 0.006以下 | Close（近似） | ベンフォードの法則に非常によく適合 |
| 0.006-0.012 | Acceptable（許容） | 十分に適合 |
| 0.012-0.015 | Marginally Acceptable（限界的） | 注意が必要 |
| 0.015超 | Nonconforming（不適合） | 不正や操作の疑いあり |

#### 第2桁の基準

| MAD値 | 判定 |
|-------|------|
| 0.008以下 | Close |
| 0.008-0.010 | Acceptable |
| 0.010-0.012 | Marginally Acceptable |
| 0.012超 | Nonconforming |

### 12.5 ベンフォード分析結果の見方

レポートのベンフォードチャートでは：

- **青棒**: 理論値（ベンフォードの法則に基づく期待値）
- **赤棒**: 実測値（実際のデータの分布）
- **乖離が大きい桁**: 不正や操作の可能性がある領域

> **注意**: ベンフォードの法則はサンプル数100件以上で有効です。
> 少数のデータでは信頼性が低下します。

---

## 13. リスクスコアリングの仕組み

### 13.1 スコア計算の概要

JAIAのリスクスコアは、各仕訳に対して0〜100の数値で算出されます。
複数の要素を統合した総合スコアです。

### 13.2 スコアの構成要素

```
総合リスクスコア = ルール違反スコア + ML異常スコア + ベンフォードスコア
                  （最大100にキャップ）
```

### 13.3 深刻度別の基本ポイント

各違反が加算するベースポイント：

| 深刻度 | ベースポイント | 説明 |
|--------|--------------|------|
| Critical | 25.0 | 不正の強い疑い |
| High | 15.0 | 要調査 |
| Medium | 10.0 | 要確認 |
| Low | 5.0 | 注意 |
| Info | 0.0 | 参考情報（スコアに影響なし） |

### 13.4 カテゴリ重み係数

違反カテゴリごとに重み係数が適用されます：

| カテゴリ | 重み係数 | 理由 |
|---------|---------|------|
| 承認（approval） | 1.5倍 | 内部統制の根幹であるため最重要視 |
| ML（ml） | 1.2倍 | ルールでは検出困難な異常のため加重 |
| 金額（amount） | 1.0倍 | 標準重み |
| 時間（time） | 1.0倍 | 標準重み |
| 勘定（account） | 1.0倍 | 標準重み |
| パターン（pattern） | 1.0倍 | 標準重み |
| トレンド（trend） | 0.9倍 | 長期的傾向であるため若干低め |
| 摘要（description） | 0.8倍 | テキストベースのため確実性がやや低い |

### 13.5 スコア計算例

以下の違反が検出された仕訳のスコア計算例：

```
違反1: AMT-003（承認閾値直下） - High (15.0) × amount重み(1.0) = 15.0
違反2: APR-001（自己承認）     - Critical (25.0) × approval重み(1.5) = 37.5
違反3: TIM-003（期末集中）     - High (15.0) × time重み(1.0) = 15.0

合計: 15.0 + 37.5 + 15.0 = 67.5 → リスクカテゴリ: High
```

### 13.6 ML・ベンフォードの加算

```
ML異常スコア = ML検出スコア(0-1) × 20.0 × ML重み(1.0)
ベンフォードスコア = ベンフォードリスク値(0-1) × 10.0 × ベンフォード重み(0.5)
```

### 13.7 リスクカテゴリと対応

| カテゴリ | スコア範囲 | 対応レベル | 推奨アクション |
|---------|----------|-----------|---------------|
| Critical | 80-100 | 即時対応 | 直ちに調査チームを編成し、詳細調査を実施 |
| High | 60-79 | 優先対応 | 1週間以内に調査担当者を割り当てて調査 |
| Medium | 40-59 | 標準対応 | 次回の定期レビューで確認 |
| Low | 20-39 | 観察 | モニタリングリストに追加 |
| Minimal | 0-19 | 対応不要 | 通常の監査手続きで対応 |

### 13.8 自動レビュー対象

- リスクスコアが **60以上**（auto_review_threshold）の仕訳は自動的にレビュー対象
- リスクスコアが **80以上**（critical_threshold）の仕訳はクリティカルフラグ付与

---

## 14. LLMプロバイダー設定ガイド

### 14.1 推奨モデル一覧

JAIAでは用途に応じて以下のモデルを推奨しています：

| 用途 | 推奨プロバイダー | 推奨モデル | 説明 |
|------|----------------|-----------|------|
| 最高精度 | Azure AI Foundry | GPT-5.2 | ARC-AGI 90%+達成の最高精度モデル |
| 高精度（エージェント向け） | AWS Bedrock | Claude Opus 4.6 | 複雑な調査・エージェント動作に最適 |
| バランス | GCP Vertex AI | Gemini 3 Pro | 日常的な分析に最適なコスパ |
| コスト重視 | GCP Vertex AI | Gemini 3 Flash Preview | 大量処理向け（$0.50/1M入力） |
| 超高速 | Azure AI Foundry | GPT-5 Nano | 最低コスト（$0.05/1M入力） |
| ローカル開発 | Ollama | Phi-4 (14B) | クラウド不要・完全無料 |

### 14.2 AWS Bedrock 設定

エンタープライズ環境で最も推奨されるプロバイダーです。

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| us.anthropic.claude-opus-4-6-20260201-v1:0 | Claude Opus 4.6 | Premium | Very High |
| us.anthropic.claude-sonnet-4-5-20250929-v1:0 | Claude Sonnet 4.5 | Balanced | Medium |
| us.anthropic.claude-haiku-4-5-20251001-v1:0 | Claude Haiku 4.5 | Fast | Low |
| amazon.nova-premier-v1:0 | Amazon Nova Premier | Premium | High |
| amazon.nova-pro-v1:0 | Amazon Nova Pro | Balanced | Medium |
| amazon.nova-lite-v1:0 | Amazon Nova Lite | Fast | Low |
| amazon.nova-micro-v1:0 | Amazon Nova Micro | Fast | Very Low |
| us.deepseek.r1-v1:0 | DeepSeek R1 | Reasoning | Medium |

#### 設定方法

```env
LLM_PROVIDER=bedrock
LLM_MODEL=us.anthropic.claude-opus-4-6-20260201-v1:0
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=AKIAxxxxxxxxxxxx
AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 14.3 Azure AI Foundry 設定

GPT-5シリーズとClaudeモデルの両方を利用可能なプロバイダーです。

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| gpt-5.2 | GPT-5.2 | Premium | Very High |
| gpt-5 | GPT-5 | Premium | High |
| gpt-5-nano | GPT-5 Nano | Fast | Low |
| claude-opus-4-6 | Claude Opus 4.6 | Premium | Very High |
| claude-sonnet-4-5 | Claude Sonnet 4.5 | Balanced | Medium |
| claude-haiku-4-5 | Claude Haiku 4.5 | Fast | Low |

#### 設定方法

```env
LLM_PROVIDER=azure_foundry
LLM_MODEL=gpt-5.2
AZURE_FOUNDRY_ENDPOINT=https://your-resource.services.ai.azure.com
AZURE_FOUNDRY_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AZURE_FOUNDRY_API_VERSION=2026-01-01
```

### 14.4 GCP Vertex AI 設定

Gemini 3シリーズを利用可能なプロバイダーです。

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| gemini-3-pro | Gemini 3 Pro | Premium | High |
| gemini-3-flash-preview | Gemini 3 Flash Preview | Balanced | Medium |
| gemini-2.5-pro | Gemini 2.5 Pro | Balanced | Medium |
| gemini-2.5-flash-lite | Gemini 2.5 Flash-Lite | Fast | Very Low |

#### 設定方法

```env
LLM_PROVIDER=vertex_ai
LLM_MODEL=gemini-3-pro
GCP_PROJECT_ID=your-project-id
GCP_LOCATION=global
```

> **注意**: Gemini 3.0シリーズは `global` リージョンのみ対応です。
> Gemini 2.5シリーズは `us-central1` 等のリージョナルエンドポイントも利用可能です。

### 14.5 Anthropic Direct API 設定

Anthropic APIに直接接続する場合の設定です。

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| claude-opus-4-6 | Claude Opus 4.6 | Premium | Very High |
| claude-sonnet-4-5 | Claude Sonnet 4.5 | Balanced | Medium |
| claude-haiku-4-5 | Claude Haiku 4.5 | Fast | Low |

#### 設定方法

```env
LLM_PROVIDER=anthropic
LLM_MODEL=claude-opus-4-6
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxx
```

### 14.6 OpenAI Direct API 設定

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| gpt-5.2 | GPT-5.2 | Premium | Very High |
| gpt-5 | GPT-5 | Premium | High |
| gpt-5-mini | GPT-5 Mini | Balanced | Medium |
| gpt-5-nano | GPT-5 Nano | Fast | Low |
| gpt-5-codex | GPT-5 Codex | Premium | Very High |
| o3-pro | o3-pro | Reasoning | Very High |
| o3 | o3 | Reasoning | High |
| o4-mini | o4-mini | Reasoning | Medium |

#### 設定方法

```env
LLM_PROVIDER=openai
LLM_MODEL=gpt-5.2
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
```

### 14.7 Google AI Studio 設定

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| gemini-3-flash-preview | Gemini 3 Flash Preview | Fast | Low |
| gemini-2.5-pro | Gemini 2.5 Pro | Premium | High |
| gemini-2.5-flash-lite | Gemini 2.5 Flash-Lite | Fast | Very Low |

#### 設定方法

```env
LLM_PROVIDER=google
LLM_MODEL=gemini-2.5-pro
GOOGLE_API_KEY=AIzaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 14.8 Azure OpenAI（Legacy）設定

既存のAzure OpenAIリソースを利用する場合の設定です。

#### 利用可能モデル

| モデルID | モデル名 | ティア | コスト |
|---------|---------|-------|--------|
| gpt-4o | GPT-4o | Premium | High |
| gpt-4o-mini | GPT-4o Mini | Balanced | Low |

#### 設定方法

```env
LLM_PROVIDER=azure
LLM_MODEL=gpt-4o
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
AZURE_OPENAI_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AZURE_OPENAI_DEPLOYMENT=your-deployment-name
AZURE_OPENAI_API_VERSION=2024-06-01
```

### 14.9 Ollama（ローカル）設定

インターネット接続なしで動作するローカルLLMプロバイダーです。

#### 利用可能モデル

| モデルID | モデル名 | ティア | 必要VRAM |
|---------|---------|-------|---------|
| phi4 | Phi-4 (14B) | Balanced | 16GB |
| qwen2.5-coder:14b | Qwen 2.5 Coder 14B | Balanced | 16GB |
| deepseek-r1:14b | DeepSeek R1 14B | Reasoning | 16GB |
| llama3.3:8b | Llama 3.3 8B | Fast | 8GB |
| gemma3:27b | Gemma 3 27B | Premium | 24GB |

#### 設定方法

1. Ollamaをインストール（https://ollama.com）
2. モデルをダウンロード: `ollama pull phi4`
3. 環境変数を設定：

```env
LLM_PROVIDER=ollama
LLM_MODEL=phi4
OLLAMA_BASE_URL=http://localhost:11434
```

#### Ollamaの利点

- **完全無料**: API料金なし
- **プライバシー**: データが外部に送信されない
- **オフライン利用**: インターネット接続不要
- **開発・テスト向け**: クラウドAPIの代替として最適

---

## 15. トラブルシューティング

### 15.1 起動・接続関連

| 問題 | 原因 | 対処法 |
|------|------|--------|
| アプリが起動しない | バックエンドサーバーの起動失敗 | ポート8090が使用中でないか確認。タスクマネージャーで確認 |
| バックエンドに接続できない | ファイアウォールがブロック | localhost:8090への接続を許可 |
| データベースエラー | DuckDBファイルの破損 | data/jaia.duckdbを削除して再インポート |

### 15.2 インポート関連

| 問題 | 原因 | 対処法 |
|------|------|--------|
| ファイルが読み込めない | ファイル形式が不正 | .xlsx / .csv形式であることを確認 |
| 文字化けが発生 | エンコーディングの不一致 | CSVをUTF-8で保存し直す |
| カラムがマッピングされない | カラム名の不一致 | AICPA GL_Detail形式のカラム名に変更 |
| インポートが遅い | データ量が多すぎる | 期間ごとに分割してインポート |
| 重複エラー | 同じgl_detail_idが存在 | 既存データを削除してから再インポート |

### 15.3 分析関連

| 問題 | 原因 | 対処法 |
|------|------|--------|
| ルール実行が遅い | データ量が多い | 並列実行をONにする。期間を絞って実行 |
| ML分析がエラー | データ数が少なすぎる | 最低100件以上のデータで実行 |
| ベンフォード分析が不正確 | サンプル数不足 | 100件以上のデータが必要 |
| メモリ不足エラー | 大量データの処理 | 期間やカテゴリを絞って分析 |

### 15.4 AI分析関連

| 問題 | 原因 | 対処法 |
|------|------|--------|
| LLM接続エラー | APIキーが不正 | 設定画面で接続テストを実行 |
| タイムアウトエラー | モデルの応答が遅い | より軽量なモデルに切り替え（Haiku, Nano等） |
| レート制限エラー | API呼び出し回数超過 | 時間をおいて再実行、またはティアの引き上げ |
| Ollama接続エラー | Ollamaが起動していない | `ollama serve` コマンドで起動 |
| 結果が不正確 | モデルの能力不足 | より高精度なモデル（Opus, GPT-5.2等）に切り替え |

### 15.5 レポート関連

| 問題 | 原因 | 対処法 |
|------|------|--------|
| PPTのチャートが表示されない | PowerPointのバージョンが古い | Office 2016以降を使用 |
| PDFの日本語が文字化け | フォントが未インストール | メイリオまたは游ゴシックをインストール |
| レポート生成が遅い | チャート生成に時間がかかる | 詳細レベルを下げて生成 |
| ファイルが保存できない | 保存先の権限不足 | 書き込み可能なフォルダを指定 |

---

## 16. 付録

### 16.1 AICPA GL_Detail形式について

JAIAのデータインポートは **AICPA（米国公認会計士協会）** が定める
**GL_Detail（総勘定元帳明細）形式** に準拠しています。

この形式は、監査データ分析における標準的なデータ形式であり、
多くのERPシステム（SAP, Oracle, Microsoft Dynamics等）から
エクスポートすることが可能です。

### 16.2 勘定科目コード体系

JAIAのルールは以下の勘定科目コード体系を前提としています：

| コード範囲 | 勘定科目分類 | 例 |
|-----------|-------------|-----|
| 1000-1999 | 流動資産 | 現金、売掛金、棚卸資産 |
| 2000-2999 | 固定資産 | 建物、機械装置、ソフトウェア |
| 3000-3999 | 流動負債 | 買掛金、未払金、仮受金 |
| 4000-4999 | 固定負債 | 長期借入金、退職給付引当金 |
| 5000-5499 | 資本 | 資本金、資本剰余金、利益剰余金 |
| 5500-5999 | 売上高 | 売上高、役務収益 |
| 6000-6999 | 売上原価・経費 | 仕入高、人件費、経費 |
| 7000-7999 | 営業外収益・費用 | 受取利息、支払利息 |
| 8000-8999 | 特別損益 | 固定資産売却益、災害損失 |
| 9000-9999 | 税金・調整 | 法人税、繰延税金 |

### 16.3 用語集

| 用語 | 説明 |
|------|------|
| GL Detail | 総勘定元帳明細。仕訳帳の各行に対応 |
| Journal Entry | 仕訳。借方と貸方の対で構成される会計記録 |
| Risk Score | リスクスコア。0-100の数値で表される異常度 |
| Violation | 違反。監査ルールに抵触した状態 |
| Anomaly | 異常。統計的またはML手法で検出された逸脱 |
| Benford's Law | ベンフォードの法則。先頭桁の出現頻度に関する法則 |
| MAD | 平均絶対偏差。ベンフォード適合度の指標 |
| Isolation Forest | 異常検知のための機械学習アルゴリズム |
| LOF | Local Outlier Factor。局所密度ベースの異常検知 |
| PCA | 主成分分析。次元削減手法 |
| LangGraph | AIエージェントのワークフロー管理フレームワーク |
| LLM | 大規模言語モデル |
| AICPA | 米国公認会計士協会 |

### 16.4 キーボードショートカット

| ショートカット | 機能 |
|---------------|------|
| Ctrl + 1 | ダッシュボードに移動 |
| Ctrl + 2 | インポートに移動 |
| Ctrl + 3 | リスク分析に移動 |
| Ctrl + 4 | AI分析に移動 |
| Ctrl + 5 | レポートに移動 |
| Ctrl + , | 設定を開く |
| Ctrl + R | 分析を再実行 |
| Ctrl + E | レポートをエクスポート |
| Ctrl + F | フィルターを開く |
| Esc | ダイアログを閉じる |

### 16.5 バージョン情報

| バージョン | リリース日 | 主な変更 |
|-----------|-----------|---------|
| 0.2.0 | 2026-02 | 8プロバイダー対応、PPT/PDFチャート強化、58ルール完備 |
| 0.1.0 | 2025-12 | 初版リリース |

---

*このマニュアルはJAIA v0.2.0に基づいて作成されています。*
*最終更新: 2026年2月14日*
